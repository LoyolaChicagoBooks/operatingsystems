<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="./" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" metia="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>IPC Topics | Operating Systems: updated 28 Dec 2023</title>
<meta content="IPC Topics | Operating Systems: updated 28 Dec 2023" property="og:title"/>
<meta content="IPC Topics | Operating Systems: updated 28 Dec 2023" name="twitter:title"/>
<link href="_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="_static/theme.css?v=7112734b" rel="stylesheet" type="text/css"/>
<link href="search.html" rel="search" title="Search"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="kernelmm.html" rel="next" title="Virtual Memory"/>
<link href="deadlock.html" rel="prev" title="Deadlock"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Operating Systems: updated 28 Dec 2023</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="index.html"><span class="font-bold text-clip whitespace-nowrap">Operating Systems: updated 28 Dec 2023</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="meta.html">About the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="processes.html">Introduction to Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="files-io.html">Files and I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Process/Thread Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutualexclusion.html">Mutual Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="deadlock.html">Deadlock</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">IPC Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernelmm.html">Virtual Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="userlandmm.html">Userland Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage and Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="fs.html">Implementing Files and Folders</a></li>
<li class="toctree-l1"><a class="reference internal" href="research.html">Storage Research at Loyola</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_vm.html">Installing a Linux Virtual Machine with VMware</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows_vm.html">Installing a Windows Virtual Machine with VMware</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="index.html">
<span class="hidden md:inline">Operating Systems: updated 28 Dec 2023</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">IPC Topics</span>
</nav>
<div id="content" role="main">
<section id="ipc-topics">
<h1>IPC Topics<a class="headerlink" href="#ipc-topics" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>Pipes</p></li>
<li><p>Named Pipes / FIFOs</p></li>
<li><p>Signals</p></li>
<li><p>Shared memory</p></li>
<li><p>Memory mapped files</p></li>
<li><p>Locking in shared memory</p></li>
<li><p>Files</p></li>
<li><p>Domain sockets</p></li>
<li><p>Doors</p></li>
<li><p>TCP/IP</p></li>
</ul>
<section id="ipc-performance-hierarchy">
<h2>IPC Performance Hierarchy<a class="headerlink" href="#ipc-performance-hierarchy" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#ipc-performance-hierarchy'">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Fastest - no kernel interaction needed, except to setup:</dt><dd><ul>
<li><p>Shared memory</p></li>
<li><p>Locking in shared memory</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Very fast - virtual memory manager involved</dt><dd><ul>
<li><p>Memory mapped files</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Fast - system calls required - i.e. context switches</dt><dd><ul>
<li><p>Pipes, FIFOs / Named Pipes</p></li>
<li><p>Signals</p></li>
<li><p>Domain sockets</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Medium / Slow - FS or network involved</dt><dd><ul>
<li><p>Files</p></li>
<li><p>TCP/UDP sockets</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="pipes">
<h2>Pipes<a class="headerlink" href="#pipes" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#pipes'">¶</a></h2>
<ul class="simple">
<li><p>Pipes are the oldest UNIX IPC mechanism aside from files.</p></li>
<li><p>Pipes are half-duplex - data only flows in one direction</p></li>
<li><p>Pipes can only be used between processes that have a common
parent. Pipes are created by a parent process and then inherited across a fork() call.</p></li>
<li><p>Passing data from one process to another through a pipe involves at least two context switches. A third one is necessary for control to return to the writing process.</p></li>
<li><p>Pipes in general are very fast. Sending data at rates of 100s to 1000s of MB/s is possible.</p></li>
</ul>
</section>
<section id="id1">
<h2>Pipes<a class="headerlink" href="#id1" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id1'">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Pipes have two file descriptors</dt><dd><ul>
<li><p>One file descriptor is read-only</p></li>
<li><p>One file descriptor is write-only</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The Linux call to create a pipe is:</dt><dd><ul>
<li><p>int pipe(int pipefd[2]);</p></li>
<li><p>pipefd[0] is the read-only half</p></li>
<li><p>pipefd[1] is the write-only half</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The Windows call to create a pipe is:</dt><dd><ul>
<li><p>BOOL CreatePipe(HANDLE readHandle, HANDLE writeHandle, LPSECURITY_ATTRIBUTES attr, DWORD nSize);</p></li>
<li><p>readHandle and writeHandle are the read/write file handles</p></li>
<li><p>attr allows processes that run under more than one user account to manage security of individual pipes</p></li>
<li><p>nSize is the suggested buffer size for the pipe</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="pipes-linux">
<h2>Pipes - Linux<a class="headerlink" href="#pipes-linux" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#pipes-linux'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="n">pipe</span><span class="p">(</span><span class="n">pipes</span><span class="p">);</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">inputPartOfPipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="linenos">12</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">outputPartOfPipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">//parent process</span>
<span class="linenos">17</span><span class="w">                </span><span class="n">dup2</span><span class="p">(</span><span class="n">inputPartOfPipe</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// redirect STDIN</span>
<span class="linenos">18</span><span class="w">                </span><span class="n">close</span><span class="p">(</span><span class="n">outputPartOfPipe</span><span class="p">);</span><span class="w">  </span><span class="c1">// close unused half of pipe</span>
<span class="linenos">19</span><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">                </span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="linenos">21</span><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"child sent value = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="linenos">22</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">//child process</span>
<span class="linenos">23</span><span class="w">                </span><span class="n">dup2</span><span class="p">(</span><span class="n">outputPartOfPipe</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// redirect STDOUT</span>
<span class="linenos">24</span><span class="w">                </span><span class="n">close</span><span class="p">(</span><span class="n">inputPartOfPipe</span><span class="p">);</span><span class="w">     </span><span class="c1">// close unused half of pipe</span>
<span class="linenos">25</span><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span>
<span class="linenos">26</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">27</span><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">"fork failed!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">28</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">        </span><span class="c1">//don't worry about closing remaining pipes,</span>
<span class="linenos">31</span><span class="w">        </span><span class="c1">//process exit does this for us</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">34</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pipes-context-switches">
<h2>Pipes - Context Switches<a class="headerlink" href="#pipes-context-switches" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#pipes-context-switches'">¶</a></h2>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/pipes-context-switches.png"><img alt="Pipes and Context Switching" src="_images/pipes-context-switches.png" style="width: 600px;"/></a>
</figure>
</section>
<section id="named-pipes-fifos">
<h2>Named Pipes / FIFOs<a class="headerlink" href="#named-pipes-fifos" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#named-pipes-fifos'">¶</a></h2>
<p>Named pipes are the same as regular pipes except:</p>
<ul class="simple">
<li><p>Named pipes live in the filesystem namespace</p></li>
<li><p>Named pipes can have a different lifespan than individual processes</p></li>
<li><p>Since named pipes are files, you can apply more advanced permissions to them</p></li>
</ul>
</section>
<section id="example-usage-of-a-regular-pipe-in-linux">
<h2>Example usage of a regular pipe in Linux<a class="headerlink" href="#example-usage-of-a-regular-pipe-in-linux" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#example-usage-of-a-regular-pipe-in-linux'">¶</a></h2>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat file | gzip -c9 &gt; file.gz
</pre></div>
</div>
<p>Example usage of a named pipe in Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkfifo pipe_file
$ gzip -c9 &lt; pipe_file &gt; file.gz
$ cat file &gt; pipe_file
$ rm -f pipe_file
</pre></div>
</div>
</section>
<section id="named-pipes-common-usages">
<h2>Named Pipes - Common Usages<a class="headerlink" href="#named-pipes-common-usages" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#named-pipes-common-usages'">¶</a></h2>
<ul class="simple">
<li><p>Named pipes are commonly used for single machine client / server applications</p></li>
<li><p>In Windows, named pipes can ride on top of TCP/IP and be used for intra-machine IPC.</p></li>
<li><dl class="simple">
<dt>To improve performance of applications that are written to only work with files and not with normal pipes.</dt><dd><ul>
<li><p>Does not work if the program uses random I/O</p></li>
<li><p>A program that is written to read a large file from disk can instead read from a named pipe. The named pipe’s data can in turn be produced by another program.</p></li>
<li><p>A program that can only work with files from the local disk can be made to work with a file on the web through a named pipe and a command that can write a URL to standard output</p></li>
<li><p>This pattern can be used to add encryption, file compression, and other extensions to programs that do not already have them.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="named-pipes-atomic-reads-writes">
<h2>Named Pipes - Atomic Reads / Writes<a class="headerlink" href="#named-pipes-atomic-reads-writes" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#named-pipes-atomic-reads-writes'">¶</a></h2>
<p>What happens if two processes write to a named pipe at the same time?</p>
<ul class="simple">
<li><p>If the size of each write(…) call is &lt;= PIPE_BUF, the writes will be atomic and in order.</p></li>
<li><p>If the size of each write(…) call is &gt; PIPE_BUF, then the individual writes will be broken up and interleaved with other simultaneous callers.</p></li>
<li><p>So, a good rule of thumb, is to make sure that what you write to a named pipe is less than PIPE_BUF in size. Otherwise, you need to guarantee that you are the only one writing to the pipe file</p></li>
</ul>
</section>
<section id="signals">
<h2>Signals<a class="headerlink" href="#signals" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#signals'">¶</a></h2>
<ul class="simple">
<li><p>Signals are software interrupts / events</p></li>
<li><p>Provide a way for handling asynchronous events</p></li>
<li><p>Modern UNIX systems have &gt; 30 different signals defined</p></li>
<li><dl class="simple">
<dt>Signals have a concept of disposition or action</dt><dd><ul>
<li><p>Ignore the signal: works for all signals except SIGKILL, SIGSTOP, and SIGEMT</p></li>
<li><p>Catch the signal: program registers with the kernel a function to handle a signal.</p></li>
<li><p>Default: allows the signal to perform its default action. Every signal has a default action</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="list-of-important-signals">
<h2>List of Important Signals<a class="headerlink" href="#list-of-important-signals" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#list-of-important-signals'">¶</a></h2>
<table class="docutils align-default" id="id15">
<caption><span class="caption-text">List of Important Signals</span><a class="headerlink" href="#id15" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 18.8%"/>
<col style="width: 81.2%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Signal</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SIGABRT</p></td>
<td><p>abnormal termination, generated by abort() function. Default terminates and core dumps the process.</p></td>
</tr>
<tr class="row-odd"><td><p>SIGALRM</p></td>
<td><p>generated when a timer expires. Set by alarm() function.</p></td>
</tr>
<tr class="row-even"><td><p>SIGBUS</p></td>
<td><p>Indicates a hardware fault. Often memory protection faults. Default terminates the application.</p></td>
</tr>
<tr class="row-odd"><td><p>SIGCHLD</p></td>
<td><p>Sent to a parent process when a child process terminates.</p></td>
</tr>
<tr class="row-even"><td><p>SIGCONT</p></td>
<td><p>Sent to a stopped process when it is continued.</p></td>
</tr>
<tr class="row-odd"><td><p>SIGEMT</p></td>
<td><p>General hardware fault</p></td>
</tr>
<tr class="row-even"><td><p>SIGFPE</p></td>
<td><p>Arithmetic exception: divide by 0, floating point overflow, etc…</p></td>
</tr>
<tr class="row-odd"><td><p>SIGHUP</p></td>
<td><p>Terminal is disconnected</p></td>
</tr>
<tr class="row-even"><td><p>SIGILL</p></td>
<td><p>The process has executed an illegal instruction (like trying to disable interrupts)</p></td>
</tr>
<tr class="row-odd"><td><p>SIGINT</p></td>
<td><p>Generated by terminal when we press Ctrl-C</p></td>
</tr>
<tr class="row-even"><td><p>SIGAIO</p></td>
<td><p>Generated when an asynchronous I/O event occurs.</p></td>
</tr>
<tr class="row-odd"><td><p>SIGKILL</p></td>
<td><p>Can’t be caught or ignored. Default action is to kill a process.</p></td>
</tr>
<tr class="row-even"><td><p>SIGPIPE</p></td>
<td><p>Generated when you write to a pipe where the reader has been terminated.</p></td>
</tr>
<tr class="row-odd"><td><p>SIGSEGV</p></td>
<td><p>Segmentation violation</p></td>
</tr>
<tr class="row-even"><td><p>SIGSTOP</p></td>
<td><p>Sent before a process is put into the stop state.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="handling-signals-example">
<h2>Handling Signals - Example<a class="headerlink" href="#handling-signals-example" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#handling-signals-example'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handler</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGUSR1</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pause</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 7</span><span class="p">}</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signalNum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">signalNum</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIGUSR1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"received SIGUSR1</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">12</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">signalNum</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIGINT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">13</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"received SIGHUP</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">14</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">15</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="sending-signals-example">
<h2>Sending Signals - Example<a class="headerlink" href="#sending-signals-example" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#sending-signals-example'">¶</a></h2>
<p>Signals can be sent to a running process using kill:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ firefox &amp;
[1] 5050
$ kill -USR1 5050        - sends signal SIGUSR to firefox
$ kill 5050              - sends signal SIGTERM to firefox
</pre></div>
</div>
</section>
<section id="signals-interrupted-system-calls">
<h2>Signals - Interrupted System Calls<a class="headerlink" href="#signals-interrupted-system-calls" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#signals-interrupted-system-calls'">¶</a></h2>
<ul class="simple">
<li><p>Signals will “wake up” blocking calls to “slow” system calls</p></li>
<li><p>In old UNIX, this was any blocking system call.</p></li>
<li><dl class="simple">
<dt>In modern UNIX, the following are “slow” system calls meaning that they can block for ever in theory:</dt><dd><ul>
<li><p>Reads from pipes, terminal devices, and network devices</p></li>
<li><p>Writes to pipes, terminal devices, and network devices if the data cannot be accepted immediately.</p></li>
<li><p>Opens of files that block until some condition occurs (such as a serial device or modem connecting).</p></li>
<li><p>All calls to the pause() function, pause() waits until signals are caught.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>This means, if you are catching signals, you will have to check errno for EINTR (interrupted by signal) error if these functions return in an error state. If they do, you must retry your operation</p></li>
<li><p>In newer UNIX systems, if signals are triggered with a SA_RESTART flag passed to sigaction(…), system calls would be automatically restarted after signal handling completes.</p></li>
</ul>
</section>
<section id="signals-reentrant-functions">
<h2>Signals - Reentrant Functions<a class="headerlink" href="#signals-reentrant-functions" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#signals-reentrant-functions'">¶</a></h2>
<ul class="simple">
<li><p>When handling a signal, the main execution of the process is suspended. The interrupted state is not something that can be examined or otherwise determined.</p></li>
<li><p>It is possible that the interrupted state could be inside of a malloc() or free() call. If we call malloc() or free() in the signal handler, we could corrupt the allocated or free list.</p></li>
<li><p>So, in signal handlers we can only call reentrant functions.</p></li>
<li><dl class="simple">
<dt>Reentrant functions have the following properties:</dt><dd><ul>
<li><p>Do not call malloc() or free()</p></li>
<li><p>Do not refer to mutable static data structures</p></li>
<li><p>Rule of thumb is to call functions that are either system calls or low level wrappers of system calls are safe. Other functions should not be used unless you are certain of their safety.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id2">
<h2>Signals - Reentrant Functions<a class="headerlink" href="#id2" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id2'">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abort</span>       <span class="n">access</span>       <span class="n">alarm</span>      <span class="n">chdir</span>       <span class="n">chmod</span>        <span class="n">chown</span>
<span class="n">close</span>       <span class="n">creat</span>        <span class="n">dup</span>        <span class="n">dup2</span>        <span class="n">execle</span>       <span class="n">execve</span>
<span class="n">exit</span>        <span class="n">fcntl</span>        <span class="n">fork</span>       <span class="n">fstat</span>       <span class="n">getgid</span>       <span class="n">getuid</span>
<span class="n">kill</span>        <span class="n">link</span>         <span class="n">longjmp</span>    <span class="n">lseek</span>       <span class="n">mkdir</span>        <span class="n">mkfifo</span>
<span class="nb">open</span>        <span class="n">pathconf</span>     <span class="n">pause</span>      <span class="n">pipe</span>        <span class="n">read</span>         <span class="n">rename</span>
<span class="n">rmdir</span>       <span class="n">setgid</span>       <span class="n">setsid</span>     <span class="n">setuid</span>      <span class="n">sigaction</span>    <span class="n">sigaddset</span>
<span class="n">sigdelset</span>   <span class="n">sigemptyset</span>  <span class="n">signal</span>     <span class="n">sigpending</span>  <span class="n">sigsuspend</span>   <span class="n">sleep</span>
<span class="n">stat</span>        <span class="n">sysconf</span>      <span class="n">time</span>       <span class="n">times</span>       <span class="n">umask</span>        <span class="n">uname</span>
<span class="n">unlink</span>      <span class="n">utime</span>        <span class="n">wait</span>       <span class="n">waitpid</span>     <span class="n">write</span>
</pre></div>
</div>
</section>
<section id="signals-sending-in-code">
<h2>Signals - Sending In Code<a class="headerlink" href="#signals-sending-in-code" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#signals-sending-in-code'">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Sending a signal to another process:</dt><dd><ul>
<li><p>int kill(pid_t pid, int signo);</p></li>
<li><p>pid &gt; 0, signal is sent to process with id = pid</p></li>
<li><p>pid = 0, signal sent to all process whose group ID is the same as the sender of the signal. Will not send to init or swapper daemons.</p></li>
<li><p>pid &lt; 0, signal is sent to all processes whose process group ID equals the absolute value of pid for which the sender has permission to send the signal.</p></li>
<li><p>pid = -1, undefined.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Sending a signal to your own process:</dt><dd><ul>
<li><p>int raise(int signo);</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Sending SIGALRM (terminates process by default):</dt><dd><ul>
<li><p>int alarm(unsigned int seconds);</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Waiting for signals:</dt><dd><ul>
<li><p>int pause(void);</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="example-implementing-sleep-with-alarm">
<h2>Example - implementing sleep() with alarm<a class="headerlink" href="#example-implementing-sleep-with-alarm" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#example-implementing-sleep-with-alarm'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">sig_alrm</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signo</span><span class="p">)</span><span class="w"> </span>
<span class="linenos"> 2</span><span class="w">    </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">       </span><span class="cm">/* ... */</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">sleepFor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">numSeconds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 7</span><span class="w">       </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span><span class="w"> </span><span class="n">sig_alrm</span><span class="p">);</span><span class="w">    </span><span class="c1">//set signal handler</span>
<span class="linenos"> 8</span><span class="w">       </span><span class="n">alarm</span><span class="p">(</span><span class="n">numSeconds</span><span class="p">);</span><span class="w">            </span><span class="c1">//set alarm for n-seconds</span>
<span class="linenos"> 9</span><span class="w">       </span><span class="n">pause</span><span class="p">();</span><span class="w">                      </span><span class="c1">//wait for signal</span>
<span class="linenos">10</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">              </span><span class="c1">//turn off alarm</span>
<span class="linenos">11</span><span class="w">       </span><span class="n">handler</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="example-better-sleep-implementation">
<h2>Example - “better” sleep implementation<a class="headerlink" href="#example-better-sleep-implementation" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#example-better-sleep-implementation'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">jmpbuf</span><span class="w"> </span><span class="n">env_alrm</span><span class="p">;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kt">void</span><span class="w"> </span><span class="nf">sig_alrm</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">longjmp</span><span class="p">(</span><span class="n">env_alrm</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="p">}</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">unsinged</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sleepFor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">numSeconds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGALRM</span><span class="p">,</span><span class="w"> </span><span class="n">sig_alrm</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">setjmp</span><span class="p">(</span><span class="n">env_alrm</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">        </span><span class="n">alarm</span><span class="p">(</span><span class="n">nsecs</span><span class="p">);</span>
<span class="linenos">11</span><span class="w">        </span><span class="n">pause</span><span class="p">();</span>
<span class="linenos">12</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">13</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">14</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="demonstrating-the-sleepfor-problem">
<h2>Demonstrating the sleepFor problem<a class="headerlink" href="#demonstrating-the-sleepfor-problem" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#demonstrating-the-sleepfor-problem'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">void</span><span class="w"> </span><span class="nf">sig_int</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"sig_int enter</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10000000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"sig_int done</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="p">}</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">sig_int</span><span class="p">);</span>
<span class="linenos">12</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">unslept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sleepFor</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">13</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"sleepFor returned: %u</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">unslept</span><span class="p">);</span>
<span class="linenos">14</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">15</span><span class="p">}</span>
<span class="linenos">16</span>
</pre></div>
</div>
</section>
<section id="history-of-sleep-and-why-signals-are-scary">
<h2>History of sleep and why signals are scary.<a class="headerlink" href="#history-of-sleep-and-why-signals-are-scary" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#history-of-sleep-and-why-signals-are-scary'">¶</a></h2>
<ul class="simple">
<li><p>These two sleep implementations are similar to historical implementations of the sleep() call in UNIX</p></li>
<li><p>Both of these demonstrate that implementations of signal handlers need to be handled with great care.</p></li>
<li><p>You must remember the following between signal and pause: Between the signal registration and the pause call, you may receive the signal. Pause could block forever because of this</p></li>
<li><dl class="simple">
<dt>You must remember the following in signal handlers:</dt><dd><ul>
<li><p>You may be interrupting execution of the main program or another signal handler.</p></li>
<li><p>Avoid modifying global variables</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Avoid non-reentrant functions</dt><dd><ul>
<li><p>Be careful of stack modifying functions like setjmp or longjmp</p></li>
<li><p>If you need this behavior, look towards sigsetjmp or siglongjmp</p></li>
<li><p>Be careful of what signals your handler generates</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="other-uses-for-alarm">
<h2>Other uses for alarm(…)<a class="headerlink" href="#other-uses-for-alarm" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#other-uses-for-alarm'">¶</a></h2>
<ul class="simple">
<li><p>Aside from using alarm() to implement a sleep() call</p></li>
<li><p>alarm() can be used to put an upper time limit on slow or blocking operations.</p></li>
<li><p>If we want to ensure that we don’t wait on a call to read from a named pipe forever, we can setup an alarm call.</p></li>
</ul>
</section>
<section id="memory-mapped-files">
<h2>Memory Mapped Files<a class="headerlink" href="#memory-mapped-files" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#memory-mapped-files'">¶</a></h2>
<ul class="simple">
<li><p>Memory mapped files are one of two ways to share memory regions between applications.</p></li>
<li><dl class="simple">
<dt>First, there are some virtual memory concepts that we need to introduce:</dt><dd><ul>
<li><p>Virtual address - the address that the program sees for an object in memory</p></li>
<li><p>Physical address - the real address (if it exists) of an object in physical memory</p></li>
<li><p>Physical and virtual addresses are almost never the same.</p></li>
<li><p>Backing store - the non physical memory location that backs a physical memory object.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>All</strong> physical memory objects have backing stores</dt><dd><ul>
<li><p>text segments - executable and library files</p></li>
<li><p>data, stack segments - swap files</p></li>
<li><p>memory mapped regions - memory mapped files</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>We will dig deeper into virtual memory in a later lecture, but these concepts will be sufficient to proceed</p></li>
</ul>
</section>
<section id="id3">
<h2>Memory Mapped Files<a class="headerlink" href="#id3" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id3'">¶</a></h2>
<ul class="simple">
<li><p>The technique used in memory mapped files is simple but very powerful.</p></li>
<li><p>Fundamentally, when you memory map a file with the mmap() function, you are declaring a region of virtual memory to be backed by a file.</p></li>
<li><p>This means, when you write to this mapped region, the values will appear (to other programs) immediately in the backing file. If the backing file is updated, the values in that file will (to the running program) appear immediately in memory.</p></li>
<li><p>When two programs map a file into virtual memory, the virtual addresses will most likely differ between the programs.</p></li>
<li><p>Two programs that have the same region of a memory mapped file mapped to memory will be able to communicate with each other by reading and writing values to that memory region</p></li>
</ul>
</section>
<section id="id4">
<h2>Memory Mapped Files<a class="headerlink" href="#id4" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id4'">¶</a></h2>
</section>
<section id="memory-mapped-files-virtual-addresses">
<h2>Memory Mapped Files - Virtual Addresses<a class="headerlink" href="#memory-mapped-files-virtual-addresses" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#memory-mapped-files-virtual-addresses'">¶</a></h2>
<ul class="simple">
<li><p>There are two instances in virtual memory where position independent code (the use of relative memory addressing) must be used.</p></li>
<li><p>Shared libraries - because the data / bss segments are shared among processes and mapped to different virtual addresses.</p></li>
<li><p>Memory mapped files - because the memory mapped file is mapped to different virtual addresses in different processes.</p></li>
<li><p>To implement position independent code, techniques similar to -fpic used in GCC must be used by code that you write to work with memory mapped regions.</p></li>
<li><dl class="simple">
<dt>Rules for writing position independent code in memory mapped regions:</dt><dd><ul>
<li><p>Do not pass pointers or structures that make use of pointers. Pointers use virtual addresses.</p></li>
<li><p>Objects in memory mapped regions should not refer to objects outside of memory mapped regions.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="absolute-memory-addressing">
<h2>Absolute Memory Addressing<a class="headerlink" href="#absolute-memory-addressing" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#absolute-memory-addressing'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="n">Brand</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">TractionRating</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">SpeedRating</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="p">}</span><span class="w"> </span><span class="n">Wheel</span><span class="p">;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">Wheel</span><span class="o">*</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="n">Wheels</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">Make</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">Model</span><span class="p">;</span>
<span class="linenos">11</span><span class="p">}</span><span class="w"> </span><span class="n">Car</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">Car</span><span class="o">*</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Car</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Car</span><span class="p">));</span>
<span class="linenos">14</span><span class="n">car</span><span class="p">.</span><span class="n">Make</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span>
<span class="linenos">15</span><span class="n">car</span><span class="p">.</span><span class="n">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span>
<span class="linenos">16</span><span class="n">car</span><span class="p">.</span><span class="n">Wheels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Wheel</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Wheel</span><span class="p">));</span>
<span class="linenos">17</span><span class="n">car</span><span class="p">.</span><span class="n">Wheels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Wheel</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Wheel</span><span class="p">));</span>
<span class="linenos">18</span><span class="n">car</span><span class="p">.</span><span class="n">Wheels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Wheel</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Wheel</span><span class="p">));</span>
<span class="linenos">19</span><span class="n">car</span><span class="p">.</span><span class="n">Wheels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Wheel</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Wheel</span><span class="p">));</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="n">car</span><span class="p">.</span><span class="n">Wheels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Brand</span>
</pre></div>
</div>
<p>Here, the location of each of the wheel objects is stored with an absolute reference from the Car. If this is shared in a memory mapped file, a call to car.Wheels[0] will not resolve to a correct address.</p>
</section>
<section id="relative-memory-addressing">
<h2>Relative Memory Addressing<a class="headerlink" href="#relative-memory-addressing" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#relative-memory-addressing'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="n">Brand</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">TractionRating</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="n">SpeedRating</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="p">}</span><span class="w"> </span><span class="n">Wheel</span><span class="p">;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">Wheel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="n">Wheels</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="n">Make</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">char</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="n">Model</span><span class="p">;</span>
<span class="linenos">11</span><span class="p">}</span><span class="w"> </span><span class="n">Car</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">Car</span><span class="o">*</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Car</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Car</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, we are using relative addressing. The entire Car struct is allocated in a contiguous memory region. To access each wheel, you need only use an offset from the beginning of the Car struct.</p>
</section>
<section id="linux-minix-use-of-mmap">
<h2>Linux / Minix - Use of mmap()<a class="headerlink" href="#linux-minix-use-of-mmap" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#linux-minix-use-of-mmap'">¶</a></h2>
<p>General Algorithm:</p>
<ol class="arabic simple">
<li><p>Process A creates file on disk</p></li>
<li><p>Process A seeks a length of N</p></li>
<li><p>Process A writes a 0 to the file</p></li>
<li><p>Process A calls mmap on the file to map it to memory</p></li>
<li><p>Process A copies its data structures into the mapped region</p></li>
<li><p>Process B calls mmap on the file to map it to memory</p></li>
<li><p>Process A and B proceed using the mapped region to cooperate</p></li>
</ol>
</section>
<section id="mmap-simple-example">
<h2>mmap - simple example<a class="headerlink" href="#mmap-simple-example" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#mmap-simple-example'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello World"</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dummyValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">dataSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">"shared.dat"</span><span class="p">,</span><span class="w"> </span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">O_TRUNC</span><span class="o">|</span><span class="n">O_RDWR</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">dataSize</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dummyValue</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="linenos"> 9</span><span class="w">    </span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">dataSize</span><span class="p">,</span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="n">fd</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">dataSize</span><span class="p">);</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">munmap</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">dataSize</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">20</span><span class="p">}</span>
<span class="linenos">21</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>mmap - simple example<a class="headerlink" href="#id6" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id6'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">fileStat</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="n">stat</span><span class="p">(</span><span class="s">"shared.dat"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fileStat</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fileSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileStat</span><span class="p">.</span><span class="n">st_size</span><span class="p">;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">"shared.dat"</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">fileSize</span><span class="p">,</span><span class="w"> </span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fileSize</span><span class="p">);</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">fileSize</span><span class="p">);</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">munmap</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">21</span><span class="p">}</span>
<span class="linenos">22</span>
</pre></div>
</div>
</section>
<section id="memory-mapped-files-atomicity">
<h2>Memory Mapped Files - Atomicity<a class="headerlink" href="#memory-mapped-files-atomicity" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#memory-mapped-files-atomicity'">¶</a></h2>
<ul class="simple">
<li><p>When we explored pipes, we learned that writing to a pipe (below a certain limit) is an atomic operation. We get this guarantee because the OS kernel guarantees this by guaranteeing that system calls are atomic.</p></li>
<li><p>The only system calls involved in memory mapped files are mmap and munmap. These are only for initializing and cleaning up mapped memory regions.</p></li>
<li><p>Reading and writing mapped memory regions does not involve system calls and carries no guarantee of atomicity. It is similar to multiple threads writing to the same heap.</p></li>
<li><dl class="simple">
<dt>To achieve atomicity in memory mapped regions, you must use:</dt><dd><ul>
<li><p>Mutexes</p></li>
<li><p>Semaphores</p></li>
<li><p>Monitors / Condition Variables</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The implementation that you use must also use relative addressing internally or otherwise be able to be configured for it.</p></li>
<li><p>The fact that memory mapped regions do not guarantee atomicity and do not use context switches is also why memory mapped regions perform so well.</p></li>
<li><p>In general, the fewer the guarantees a mechanism provides, the faster it is.</p></li>
</ul>
</section>
<section id="memory-mapped-files-bounded-buffer">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#memory-mapped-files-bounded-buffer" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#memory-mapped-files-bounded-buffer'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;semaphore.h&gt;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MessageQueueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxMessageSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">class</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 7</span><span class="n">public</span><span class="o">:</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="o">~</span><span class="n">Message</span><span class="p">();</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">EnqueueMessage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">DequeueMessage</span><span class="p">();</span>
<span class="linenos">11</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="nf">CopyToMemoryMappedFile</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">12</span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="nf">GetFromMemoryMappedFile</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">13</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReleaseFile</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">14</span><span class="n">private</span><span class="o">:</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">Message</span><span class="p">();</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">sem_t</span><span class="w"> </span><span class="n">_lock</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">  </span><span class="n">sem_t</span><span class="w"> </span><span class="n">_empty</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">sem_t</span><span class="w"> </span><span class="n">_full</span><span class="p">;</span>
<span class="linenos">19</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">_current</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">_messages</span><span class="p">[</span><span class="n">MessageQueueSize</span><span class="p">][</span><span class="n">MaxMessageSize</span><span class="p">];</span>
<span class="linenos">21</span><span class="p">};</span>
<span class="linenos">22</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#id7" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id7'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">Message</span><span class="o">::</span><span class="n">Message</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_lock</span><span class="p">,</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">                                </span><span class="c1">//passing 1 as the 2nd parameter allows the</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_empty</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">                              </span><span class="c1">//semaphore work in a memory mapped region</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_full</span><span class="p">,</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">MessageQueueSize</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">_current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 6</span><span class="p">}</span>
<span class="linenos"> 7</span><span class="n">Message</span><span class="o">::~</span><span class="n">Message</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 8</span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="n">Message</span><span class="o">::</span><span class="n">CopyToMemoryMappedFile</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">datasize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"message size = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">datasize</span><span class="p">);</span>
<span class="linenos">11</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">),</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">     </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"error in lseek</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">13</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">dummyVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dummyVal</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">     </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"error in write</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">18</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">),</span><span class="w"> </span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">map</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">     </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"mmap() returned -1</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">21</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Message</span><span class="p">();</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">));</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">delete</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Message</span><span class="o">*</span><span class="p">)</span><span class="n">map</span><span class="p">;</span>
<span class="linenos">26</span><span class="p">}</span>
<span class="linenos">27</span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#id8" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id8'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="nf">Message::GetFromMemoryMappedFile</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mmap</span><span class="p">(</span>
<span class="linenos"> 3</span><span class="w">     </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">),</span><span class="w"> </span>
<span class="linenos"> 4</span><span class="w">     </span><span class="p">(</span><span class="n">PROT_READ</span><span class="o">|</span><span class="n">PROT_WRITE</span><span class="p">),</span><span class="w"> </span><span class="n">MAP_SHARED</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">map</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 6</span><span class="w">     </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"mmap() returned -1</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">Message</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Message</span><span class="o">*</span><span class="p">)</span><span class="n">map</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="linenos">10</span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="kt">void</span><span class="w"> </span><span class="nf">Message::ReleaseFile</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">munmap</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Message</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">14</span><span class="w">     </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"munmap() failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">15</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">16</span><span class="p">}</span>
<span class="linenos">17</span>
</pre></div>
</div>
</section>
<hr class="docutils"/>
<section id="id9">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#id9" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id9'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">void</span><span class="w"> </span><span class="nf">Message::EnqueueMessage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_full</span><span class="p">);</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_lock</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">_current</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_messages</span><span class="p">[</span><span class="n">_current</span><span class="p">],</span><span class="w"> </span><span class="n">MaxMessageSize</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_messages</span><span class="p">[</span><span class="n">_current</span><span class="p">],</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_lock</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_empty</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="p">}</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">Message::DequeueMessage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">MaxMessageSize</span><span class="p">];</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_empty</span><span class="p">);</span>
<span class="linenos">14</span><span class="w">  </span><span class="n">sem_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_lock</span><span class="p">);</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_messages</span><span class="p">[</span><span class="n">_current</span><span class="p">],</span><span class="w"> </span><span class="n">MaxMessageSize</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">_current</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">  </span><span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_lock</span><span class="p">);</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">sem_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_full</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="linenos">20</span><span class="p">}</span>
<span class="linenos">21</span>
</pre></div>
</div>
</section>
<section id="id10">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#id10" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id10'">¶</a></h2>
<p>Producer Code</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sharedFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"shared.dat"</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">mode_t</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0666</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">openFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">O_CREAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_TRUNC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">sharedFileName</span><span class="p">,</span><span class="w"> </span><span class="n">openFlags</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">"open returned (-1)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">Message</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="o">::</span><span class="n">CopyToMemoryMappedFile</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">     </span><span class="kt">char</span><span class="w"> </span><span class="n">message</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="linenos">16</span><span class="w">     </span><span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">     </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">EnqueueMessage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos">18</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">"enqueued %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"message queue written</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">21</span><span class="w">  </span><span class="n">getchar</span><span class="p">();</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">Message</span><span class="o">::</span><span class="n">ReleaseFile</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">24</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id11">
<h2>Memory Mapped Files - Bounded Buffer<a class="headerlink" href="#id11" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id11'">¶</a></h2>
<p>Consumer Code</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sharedFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"shared.dat"</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">mode_t</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0666</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">openFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">O_RDWR</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">sharedFileName</span><span class="p">,</span><span class="w"> </span><span class="n">openFlags</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">"open returned (-1)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">Message</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="o">::</span><span class="n">GetFromMemoryMappedFile</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">17</span><span class="w">     </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">DequeueMessage</span><span class="p">();</span>
<span class="linenos">18</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d: %s"</span><span class="p">,</span><span class="w"> </span><span class="o">++</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">     </span><span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="linenos">20</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">Message</span><span class="o">::</span><span class="n">ReleaseFile</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">25</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="memory-mapped-files-fast-i-o">
<h2>Memory Mapped Files - Fast I/O<a class="headerlink" href="#memory-mapped-files-fast-i-o" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#memory-mapped-files-fast-i-o'">¶</a></h2>
<p>Memory mapped I/O is faster because it avoids a copy from user mode to kernel mode</p>
<p>Normal User - Kernel write(…) call algorithm:</p>
<ol class="arabic simple">
<li><p>user app - write(fd, user_buf, len);</p></li>
<li><p>user app - context switch into OS (software interrupt)</p></li>
<li><p>kernel mode - allocate space in file, check security, etc…</p></li>
<li><p>kernel mode - copy user_buf to FS buffer cache</p></li>
<li><p>kernel mode - context switch into user app (interrupt return)</p></li>
<li><p>at some later time, kernel commits buffer cache to disk</p></li>
</ol>
<p>Normal User - Kernel mmap(…) write algorithm:</p>
<ol class="arabic simple">
<li><p>user app - copy values to mapped region</p></li>
<li><p>kernel mode - MMU triggers page fault (hardware interrupt)</p></li>
<li><p>kernel mode - writes page to backing store</p></li>
<li><p>kernel mode - context switch to user app (interrupt return)</p></li>
</ol>
</section>
<section id="id12">
<h2>Memory Mapped Files - Fast I/O<a class="headerlink" href="#id12" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id12'">¶</a></h2>
<ul class="simple">
<li><p>The read algorithm for regular read vs. mmap read is very similar to the write algorithm and also avoids a kernel to user mode copy</p></li>
<li><p>On systems with large address spaces (64-bit), memory mapped I/O can be very advantageous. - For example, a database server can memory map an entire database that is several TB in size into memory.</p></li>
<li><p>Since most VM systems user a very efficient LRU algorithm and have a lot of I/O scheduling data, memory mapping large files is amongst the fastest approaches.</p></li>
<li><p>Other advanced approaches include scatter/gather or vectored I/O.</p></li>
<li><p>Memory mapped I/O carries the greatest advantage when the structure of the file maps well into the domain model. This means that no serialization / deserialization is needed.</p></li>
</ul>
</section>
<section id="files-ipc">
<h2>Files - IPC<a class="headerlink" href="#files-ipc" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#files-ipc'">¶</a></h2>
<ul class="simple">
<li><p>Files are the oldest and most generally used form of IPC</p></li>
<li><p>Almost every resource in a modern operating system is accessible through a file based contract (open, read, write, seek, close)</p></li>
<li><p>File based IPC is available in almost every operating system.</p></li>
<li><dl class="simple">
<dt>File based IPC, in modern times is best considered in a few patterns:</dt><dd><ul>
<li><p>State persistence - beyond the lifetime of a program</p></li>
<li><p>Exposing current state - during program execution</p></li>
<li><p>Queues / Spooling folders - mail daemons, printers, execution queues</p></li>
<li><p>Resource state expression - lock files, availability, etc…</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="files-exposing-current-state">
<h2>Files - Exposing Current State<a class="headerlink" href="#files-exposing-current-state" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#files-exposing-current-state'">¶</a></h2>
<p>/proc filesystems are important ways for OS designers to expose system
information without inventing new system calls.</p>
<ul class="simple">
<li><p>This is a key advantage for kernel module developers and for device driver developers</p></li>
<li><p>Also provides a great way to debug kernel changes</p></li>
</ul>
<table class="docutils align-default" id="id16">
<caption><span class="caption-text">List of /proc-style Filesystems</span><a class="headerlink" href="#id16" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 25.0%"/>
<col style="width: 75.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Filesystem</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Filesystem</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-odd"><td><p>/proc/vmstat</p></td>
<td><p>virtual memory stats and configuration</p></td>
</tr>
<tr class="row-even"><td><p>/proc/cpuinfo</p></td>
<td><p>individual CPU information</p></td>
</tr>
<tr class="row-odd"><td><p>/proc/&lt;PID&gt;</p></td>
<td><p>individual process information</p></td>
</tr>
<tr class="row-even"><td><p>/proc/loadavg</p></td>
<td><p>moving average of ready process load</p></td>
</tr>
</tbody>
</table>
</section>
<section id="spool-folders">
<h2>Spool Folders<a class="headerlink" href="#spool-folders" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#spool-folders'">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Spool folders are most commonly used for:</dt><dd><ul>
<li><p>E-mail daemons (Postfix, Exchange, etc…)</p></li>
<li><p>Printer managers (CUPS, lpr, etc…)</p></li>
<li><p>Job managers (CRON, etc…)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Spool folders are folders reserved for a single process that’s single task is to monitor the folder and process each new file created in the folder. Each file in the folder represents a task to complete.</p></li>
<li><p>Spool folders, like other persisted queueing systems are resilient to failure. If the processing daemon crashes, it can be restarted without losing the task list.</p></li>
<li><p>Often, spool folders are processed by some defined order. One typical order is to process files alphabetically.</p></li>
<li><p>If the jobs are not meant to be repeated, files are typically moved to another folder upon completion or deleted.</p></li>
</ul>
</section>
<section id="spool-folders-cron">
<h2>Spool Folders - Cron<a class="headerlink" href="#spool-folders-cron" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#spool-folders-cron'">¶</a></h2>
<p>Cron typically maintains a few spool folders under /etc:</p>
<ul class="simple">
<li><p>/etc/cron.daily</p></li>
<li><p>/etc/cron.hourly</p></li>
<li><p>/etc/cron.monthly</p></li>
<li><p>/etc/cron.weekly</p></li>
</ul>
<p>Cron will, at the correct time, enter each of these folders and execute every executable file in each of these folders.</p>
</section>
<section id="spool-folders-cups">
<h2>Spool Folders - CUPS<a class="headerlink" href="#spool-folders-cups" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#spool-folders-cups'">¶</a></h2>
<ul class="simple">
<li><p>CUPS is a printer daemon for UNIX operating systems</p></li>
<li><p>The spool folder for CUPS is typically /var/spool/cups</p></li>
<li><dl class="simple">
<dt>In the spool folder there are two types of files:</dt><dd><ul>
<li><dl class="simple">
<dt>Data files - The object that is being printed</dt><dd><ul>
<li><p>Named d00001-001, d00001-002, d00002-001,….</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Control files - A file that represents a set of data files</dt><dd><ul>
<li><p>Named c00001, c00002, ….</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>The use of this file naming convention exposes a domain model of sorts that the CUPS system respects in its queue.</p></li>
<li><p>CUPS has a series of programs that manage the creation of files in the spooling folder and the processing of files once in the spooling folder.</p></li>
</ul>
</section>
<section id="lock-files">
<h2>Lock Files<a class="headerlink" href="#lock-files" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#lock-files'">¶</a></h2>
<ul class="simple">
<li><p>A useful aspect of all system calls is that they are atomic operations. This means that some system calls can be used to perform test-and-set like operations and be the basis of locking systems.</p></li>
<li><dl class="simple">
<dt>A common example is the use of files to make sure only one instance of a software program is running at one time.</dt><dd><ul>
<li><p>For example, you would not want to HTTP daemons running on the same port.</p></li>
<li><p>To prevent this, you could create a lock file like /var/lock/http_80.</p></li>
<li><p>When the HTTP daemon starts up, it can check very early on for a /var/lock/http_## for the port it is configured on before proceeding. When the daemon shuts down it can delete the file</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The creation of and deletion of files is an atomic operation. So, if two processes both try at the same time to create the same file, only one will succeed.</p></li>
</ul>
</section>
<section id="doors">
<h2>Doors<a class="headerlink" href="#doors" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#doors'">¶</a></h2>
<ul class="simple">
<li><p>Doors pretty much only exist on Solaris and nowhere else</p></li>
<li><p>Even so, they are an interesting concept.</p></li>
<li><p>Doors basically allow a process to expose one or more functions through one or more files on the filesystem. It is basically a file system based RPC mechanism</p></li>
</ul>
</section>
<section id="server-code">
<h2>Server Code<a class="headerlink" href="#server-code" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#server-code'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">void</span><span class="w"> </span><span class="nf">server</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">cookie</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argp</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">arg_size</span><span class="p">,</span><span class="w"> </span><span class="n">door_desc_t</span><span class="o">*</span><span class="w"> </span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="n">uint_t</span><span class="w"> </span><span class="n">n_desc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="cm">/*server code goes here*/</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="p">}</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kt">int</span><span class="w"> </span><span class="n">doorfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">door_create</span><span class="p">(</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">creat</span><span class="p">(</span><span class="s">"/tmp/door"</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="n">fdetach</span><span class="p">(</span><span class="s">"/tmp/door"</span><span class="p">);</span>
<span class="linenos">10</span><span class="n">fattach</span><span class="p">(</span><span class="n">doorfd</span><span class="p">,</span><span class="s">"/tmp/door"</span><span class="p">);</span>
<span class="linenos">11</span><span class="n">pause</span><span class="p">();</span>
<span class="linenos">12</span>
</pre></div>
</div>
</section>
<section id="client-code">
<h2>Client Code<a class="headerlink" href="#client-code" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#client-code'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">typdef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">myArg</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span>
<span class="linenos"> 3</span><span class="p">}</span><span class="w"> </span><span class="n">myArg_t</span><span class="p">;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">door_arg_t</span><span class="w"> </span><span class="n">d_arg</span><span class="p">;</span>
<span class="linenos"> 6</span><span class="kt">int</span><span class="w"> </span><span class="n">doorfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">"/tmp/door"</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="n">myArg_t</span><span class="o">*</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">myArg_t</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">myArg_t</span><span class="p">));</span>
<span class="linenos"> 8</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="n">d_arg</span><span class="p">.</span><span class="n">data_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
<span class="linenos">10</span><span class="n">d_arg</span><span class="p">.</span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">);</span>
<span class="linenos">11</span><span class="n">d_arg</span><span class="p">.</span><span class="n">desc_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">12</span><span class="n">d_arg</span><span class="p">.</span><span class="n">desc_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">13</span><span class="n">door_call</span><span class="p">(</span><span class="n">doorfd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d_arg</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="domain-sockets">
<h2>Domain Sockets<a class="headerlink" href="#domain-sockets" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#domain-sockets'">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>Domain sockets serve the same purpose as named pipes, except that domain sockets are:</dt><dd><ul>
<li><p>Full - duplex</p></li>
<li><p>Can have many clients to one server</p></li>
<li><p>Support datagram and streaming modes</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Domain sockets use functions that are very similar to what is used with internet sockets:</dt><dd><ul>
<li><p>accept, bind, listen, connect, socket</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The setup for domain sockets can be a bit complex, so the best way to explain is through a simple example.</p></li>
</ul>
</section>
<section id="domain-sockets-example">
<h2>Domain Sockets - Example<a class="headerlink" href="#domain-sockets-example" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#domain-sockets-example'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">server_listen</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="n">unlink</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">socket_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">PF_UNIX</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="p">));</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">address</span><span class="p">.</span><span class="n">sun_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_UNIX</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">);</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">bind</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="p">));</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">listen</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="linenos">11</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">connection_fd</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">  </span><span class="kt">socklen_t</span><span class="w"> </span><span class="n">address_length</span><span class="p">;</span>
<span class="linenos">13</span><span class="w">  </span><span class="k">while</span><span class="p">((</span><span class="n">connection_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accept</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">address_length</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">14</span><span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
<span class="linenos">15</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">child</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">connection_handler</span><span class="p">(</span><span class="n">connection_fd</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">     </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">18</span><span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">connection_fd</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">     </span><span class="p">}</span><span class="w"> </span>
<span class="linenos">20</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">);</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">unlink</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">25</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id13">
<h2>Domain Sockets - Example<a class="headerlink" href="#id13" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id13'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">connection_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">socket_fd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buff</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">nBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">buff</span><span class="p">[</span><span class="n">nBytes</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"message from client: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">);</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">nBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="s">"hello from server"</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">write</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="n">nBytes</span><span class="p">);</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">11</span><span class="p">}</span>
<span class="linenos">12</span>
</pre></div>
</div>
</section>
<section id="id14">
<h2>Domain Sockets - Example<a class="headerlink" href="#id14" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#id14'">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kt">int</span><span class="w"> </span><span class="nf">client_connect</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">socket_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">PF_UNIX</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="p">));</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">address</span><span class="p">.</span><span class="n">sun_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_UNIX</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">);</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">connect</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_un</span><span class="p">));</span>
<span class="linenos">10</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="linenos">11</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">nBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="s">"hello from a client"</span><span class="p">);</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">write</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">nBytes</span><span class="p">);</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">  </span><span class="n">nBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">256</span><span class="p">);</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">buffer</span><span class="p">[</span><span class="n">nBytes</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">"message from server: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">close</span><span class="p">(</span><span class="n">socket_fd</span><span class="p">);</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span><span class="p">}</span>
<span class="linenos">23</span>
</pre></div>
</div>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(var(--vh)-4rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#ipc-performance-hierarchy'" class="reference internal" href="#ipc-performance-hierarchy">IPC Performance Hierarchy</a></li>
<li><a :data-current="activeSection === '#pipes'" class="reference internal" href="#pipes">Pipes</a></li>
<li><a :data-current="activeSection === '#id1'" class="reference internal" href="#id1">Pipes</a></li>
<li><a :data-current="activeSection === '#pipes-linux'" class="reference internal" href="#pipes-linux">Pipes - Linux</a></li>
<li><a :data-current="activeSection === '#pipes-context-switches'" class="reference internal" href="#pipes-context-switches">Pipes - Context Switches</a></li>
<li><a :data-current="activeSection === '#named-pipes-fifos'" class="reference internal" href="#named-pipes-fifos">Named Pipes / FIFOs</a></li>
<li><a :data-current="activeSection === '#example-usage-of-a-regular-pipe-in-linux'" class="reference internal" href="#example-usage-of-a-regular-pipe-in-linux">Example usage of a regular pipe in Linux</a></li>
<li><a :data-current="activeSection === '#named-pipes-common-usages'" class="reference internal" href="#named-pipes-common-usages">Named Pipes - Common Usages</a></li>
<li><a :data-current="activeSection === '#named-pipes-atomic-reads-writes'" class="reference internal" href="#named-pipes-atomic-reads-writes">Named Pipes - Atomic Reads / Writes</a></li>
<li><a :data-current="activeSection === '#signals'" class="reference internal" href="#signals">Signals</a></li>
<li><a :data-current="activeSection === '#list-of-important-signals'" class="reference internal" href="#list-of-important-signals">List of Important Signals</a></li>
<li><a :data-current="activeSection === '#handling-signals-example'" class="reference internal" href="#handling-signals-example">Handling Signals - Example</a></li>
<li><a :data-current="activeSection === '#sending-signals-example'" class="reference internal" href="#sending-signals-example">Sending Signals - Example</a></li>
<li><a :data-current="activeSection === '#signals-interrupted-system-calls'" class="reference internal" href="#signals-interrupted-system-calls">Signals - Interrupted System Calls</a></li>
<li><a :data-current="activeSection === '#signals-reentrant-functions'" class="reference internal" href="#signals-reentrant-functions">Signals - Reentrant Functions</a></li>
<li><a :data-current="activeSection === '#id2'" class="reference internal" href="#id2">Signals - Reentrant Functions</a></li>
<li><a :data-current="activeSection === '#signals-sending-in-code'" class="reference internal" href="#signals-sending-in-code">Signals - Sending In Code</a></li>
<li><a :data-current="activeSection === '#example-implementing-sleep-with-alarm'" class="reference internal" href="#example-implementing-sleep-with-alarm">Example - implementing sleep() with alarm</a></li>
<li><a :data-current="activeSection === '#example-better-sleep-implementation'" class="reference internal" href="#example-better-sleep-implementation">Example - “better” sleep implementation</a></li>
<li><a :data-current="activeSection === '#demonstrating-the-sleepfor-problem'" class="reference internal" href="#demonstrating-the-sleepfor-problem">Demonstrating the sleepFor problem</a></li>
<li><a :data-current="activeSection === '#history-of-sleep-and-why-signals-are-scary'" class="reference internal" href="#history-of-sleep-and-why-signals-are-scary">History of sleep and why signals are scary.</a></li>
<li><a :data-current="activeSection === '#other-uses-for-alarm'" class="reference internal" href="#other-uses-for-alarm">Other uses for alarm(…)</a></li>
<li><a :data-current="activeSection === '#memory-mapped-files'" class="reference internal" href="#memory-mapped-files">Memory Mapped Files</a></li>
<li><a :data-current="activeSection === '#id3'" class="reference internal" href="#id3">Memory Mapped Files</a></li>
<li><a :data-current="activeSection === '#id4'" class="reference internal" href="#id4">Memory Mapped Files</a></li>
<li><a :data-current="activeSection === '#memory-mapped-files-virtual-addresses'" class="reference internal" href="#memory-mapped-files-virtual-addresses">Memory Mapped Files - Virtual Addresses</a></li>
<li><a :data-current="activeSection === '#absolute-memory-addressing'" class="reference internal" href="#absolute-memory-addressing">Absolute Memory Addressing</a></li>
<li><a :data-current="activeSection === '#relative-memory-addressing'" class="reference internal" href="#relative-memory-addressing">Relative Memory Addressing</a></li>
<li><a :data-current="activeSection === '#linux-minix-use-of-mmap'" class="reference internal" href="#linux-minix-use-of-mmap">Linux / Minix - Use of mmap()</a></li>
<li><a :data-current="activeSection === '#mmap-simple-example'" class="reference internal" href="#mmap-simple-example">mmap - simple example</a></li>
<li><a :data-current="activeSection === '#id6'" class="reference internal" href="#id6">mmap - simple example</a></li>
<li><a :data-current="activeSection === '#memory-mapped-files-atomicity'" class="reference internal" href="#memory-mapped-files-atomicity">Memory Mapped Files - Atomicity</a></li>
<li><a :data-current="activeSection === '#memory-mapped-files-bounded-buffer'" class="reference internal" href="#memory-mapped-files-bounded-buffer">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#id7'" class="reference internal" href="#id7">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#id8'" class="reference internal" href="#id8">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#id9'" class="reference internal" href="#id9">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#id10'" class="reference internal" href="#id10">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#id11'" class="reference internal" href="#id11">Memory Mapped Files - Bounded Buffer</a></li>
<li><a :data-current="activeSection === '#memory-mapped-files-fast-i-o'" class="reference internal" href="#memory-mapped-files-fast-i-o">Memory Mapped Files - Fast I/O</a></li>
<li><a :data-current="activeSection === '#id12'" class="reference internal" href="#id12">Memory Mapped Files - Fast I/O</a></li>
<li><a :data-current="activeSection === '#files-ipc'" class="reference internal" href="#files-ipc">Files - IPC</a></li>
<li><a :data-current="activeSection === '#files-exposing-current-state'" class="reference internal" href="#files-exposing-current-state">Files - Exposing Current State</a></li>
<li><a :data-current="activeSection === '#spool-folders'" class="reference internal" href="#spool-folders">Spool Folders</a></li>
<li><a :data-current="activeSection === '#spool-folders-cron'" class="reference internal" href="#spool-folders-cron">Spool Folders - Cron</a></li>
<li><a :data-current="activeSection === '#spool-folders-cups'" class="reference internal" href="#spool-folders-cups">Spool Folders - CUPS</a></li>
<li><a :data-current="activeSection === '#lock-files'" class="reference internal" href="#lock-files">Lock Files</a></li>
<li><a :data-current="activeSection === '#doors'" class="reference internal" href="#doors">Doors</a></li>
<li><a :data-current="activeSection === '#server-code'" class="reference internal" href="#server-code">Server Code</a></li>
<li><a :data-current="activeSection === '#client-code'" class="reference internal" href="#client-code">Client Code</a></li>
<li><a :data-current="activeSection === '#domain-sockets'" class="reference internal" href="#domain-sockets">Domain Sockets</a></li>
<li><a :data-current="activeSection === '#domain-sockets-example'" class="reference internal" href="#domain-sockets-example">Domain Sockets - Example</a></li>
<li><a :data-current="activeSection === '#id13'" class="reference internal" href="#id13">Domain Sockets - Example</a></li>
<li><a :data-current="activeSection === '#id14'" class="reference internal" href="#id14">Domain Sockets - Example</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2013-2020, Operating Systems Faculty at Loyola University Chicago Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 7.2.6</a></p>
</div>
</div>
</footer>
</div>
<script src="_static/documentation_options.js?v=360e3fcb"></script>
<script src="_static/doctools.js?v=888ff710"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="_static/theme.js?v=e8bd915e"></script>
</body>
</html>