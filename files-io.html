<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Files and I/O &mdash; Operating Systems Updated 2021-09-25 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Process/Thread Scheduling" href="scheduling.html" />
    <link rel="prev" title="Introduction to Processes" href="processes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #922247" >
            <a href="index.html" class="icon icon-home"> Operating Systems
          </a>
              <div class="version">
                Updated 2021-09-25
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="meta.html">About the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="processes.html">Introduction to Processes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Files and I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Process/Thread Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutualexclusion.html">Mutual Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="deadlock.html">Deadlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">IPC Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernelmm.html">Virtual Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="userlandmm.html">Userland Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage and Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="fs.html">Implementing Files and Folders</a></li>
<li class="toctree-l1"><a class="reference internal" href="research.html">Storage Research at Loyola</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_vm.html">Installing a Linux Virtual Machine with VMware</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows_vm.html">Installing a Windows Virtual Machine with VMware</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #922247" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Operating Systems</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Files and I/O</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/files-io.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="files-and-i-o">
<h1>Files and I/O<a class="headerlink" href="#files-and-i-o" title="Permalink to this headline"></a></h1>
<section id="common-attributes-of-all-unix-files">
<h2>Common attributes of all (UNIX) files<a class="headerlink" href="#common-attributes-of-all-unix-files" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>All files:</p>
<ul>
<li><p>Live in the filesystem namespace (under root, or <code class="docutils literal notranslate"><span class="pre">/</span></code>). No drive letters!</p></li>
<li><p>Have a name</p></li>
<li><p>Implement read, write, open, close, and select system calls.</p></li>
</ul>
</li>
<li><p>All can be contained in either normal or <em>special</em> folders</p></li>
<li><p>All have a concept of a:</p>
<ul>
<li><p>Owning user and group</p></li>
</ul>
</li>
<li><p>Read/write/execute bits for the owning user/group, and for other
users/groups</p></li>
<li><p>A list of custom extended attributes</p></li>
<li><p>Creation date/time</p></li>
<li><p>Last accessed date/time</p></li>
<li><p>Beyond these few things, there’s a great degree of variety in
semantics and structure for various file types</p></li>
</ul>
</section>
<section id="types-of-files-in-unix">
<h2>Types of Files in Unix<a class="headerlink" href="#types-of-files-in-unix" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Regular files</p></li>
<li><p>Symbolic links</p></li>
<li><p>Folders</p></li>
<li><p>Block device files</p></li>
<li><p>Character device files</p></li>
<li><p>Named pipes/FIFOs</p></li>
<li><p>UNIX domain sockets</p></li>
<li><p>Doors (Solaris only)</p></li>
</ul>
</section>
<section id="regular-files">
<h2>Regular Files<a class="headerlink" href="#regular-files" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Persist data from programs. Reside in filesystems.</p></li>
<li><p>In addition to owner/permissions. Regular files have:</p>
<ul>
<li><p>A committed and defined size (which differ for filesystems that
support sparse files)</p></li>
<li><p>Can be accessed sequentially</p></li>
<li><p>Can be accessed in random order</p></li>
</ul>
</li>
<li><p>Exceptions exist for device restrictions such as exit for tape drives</p></li>
</ul>
</section>
<section id="folders">
<h2>Folders<a class="headerlink" href="#folders" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>In early UNIX implementations, folders were files that listed other
files and had a special bit set to make them folders.</p></li>
<li><p>Folders were modified by reading from and writing to the file.</p></li>
<li><p>Some of these semantics still exist</p></li>
<li><p>Early operating systems did not support folders:</p>
<ul>
<li><p>Macintosh file system (circa 1984)</p></li>
<li><p>CP/M file system (predecessor to MS-DOS and FAT)</p></li>
</ul>
</li>
<li><p>Folders do not have a file size</p></li>
<li><p>The execute bit for a folder determines:</p>
<ul>
<li><p>If the contents of the folder may be listed</p></li>
<li><p>If a program may change use it as its working folder</p></li>
</ul>
</li>
</ul>
</section>
<section id="symbolic-links">
<h2>Symbolic Links<a class="headerlink" href="#symbolic-links" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Symbolic links are a type of file that points to another file or
folder.</p></li>
<li><p>The pointer can be either a relative or absolute path.</p></li>
<li><p>Support exists in many modern operating systems (OS X, UNIX, and
Windows)</p></li>
<li><p>A symbolic link that refers to a file or folder that does not exist
is called ‘broken’</p></li>
<li><p>File system operations on a symbolic link work on the file that they
point to with the exception of the unlink system call (to delete the
symbolic link)</p></li>
<li><p>Other system calls exist to help determine if a file/folder is a
symbolic link or a real file/folder</p></li>
</ul>
</section>
<section id="block-device-files">
<h2>Block Device Files<a class="headerlink" href="#block-device-files" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Block device files are file abstractions for devices exposed by the
operating system.</p></li>
<li><p>Common device block files are:</p>
<ul>
<li><p>Hard disks</p></li>
<li><p>CD/DVD/Blu-Ray drives</p></li>
<li><p>Floppy drives</p></li>
<li><p>USB media</p></li>
<li><p>Mapped memory devices (RAM disks, or diagnostic devices)</p></li>
</ul>
</li>
<li><p>Block devices support:</p>
<ul>
<li><p>Random access</p></li>
<li><p>Buffered read/write (through some characteristic block size)</p></li>
<li><p>Block device files are either automatically exposed by the
operating system through special file systems or are user created
through special system programs and system calls. Approaches vary.</p></li>
<li><p>Early Linux depended upon special programs</p></li>
<li><p>Modern Linux uses special filesystems (devfs, sysfs)</p></li>
</ul>
</li>
</ul>
</section>
<section id="character-device-files">
<h2>Character Device Files<a class="headerlink" href="#character-device-files" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Character device files are file abstractions for devices exposed by
the operating system.</p></li>
<li><p>Common character devices are:</p>
<ul>
<li><p>terminals</p></li>
<li><p>serial ports</p></li>
<li><p>modems</p></li>
<li><p>network cards</p></li>
<li><p>video/sound devices</p></li>
<li><p>tape drives</p></li>
</ul>
</li>
<li><p>Most character devices do not support random access.</p></li>
<li><p>Those that do, typically have a high cost for seek operations</p></li>
</ul>
</section>
<section id="named-pipes-fifos">
<h2>Named Pipes/FIFOs<a class="headerlink" href="#named-pipes-fifos" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Named pipes are pipes that exist in the filesystem.</p></li>
<li><p>Allow for pipe operations in sets of programs that have different
lifetimes such as client server programs.</p></li>
<li><p>We will dig into more detail on pipes when we discuss inter-process
communication.</p></li>
</ul>
</section>
<section id="unix-domain-sockets">
<h2>Unix Domain Sockets<a class="headerlink" href="#unix-domain-sockets" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Domain sockets are sockets that have a name in the filesystem.</p></li>
<li><p>Similar to named pipes except they can be created in a streaming or
datagram mode</p></li>
<li><p>Unlike regular sockets, domain sockets do not have an underlying
TCP/IP or UDP/IP protocol</p></li>
</ul>
</section>
<section id="filesystem-system-calls">
<h2>Filesystem System Calls<a class="headerlink" href="#filesystem-system-calls" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>A majority of the system calls in a UNIX operating system exist to
operate upon files</p></li>
<li><p>The acronym MS-DOS expands to MicroSoft Disk Operating System. The
DOS part of this acronym seems to greatly apply to all operating
systems.</p></li>
</ul>
</section>
<section id="id1">
<h2>Filesystem System Calls<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">Filesystem Calls</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">open()</span></code></p></td>
<td><p>opens/creates files and returns a file descriptor</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">creat()</span></code></p></td>
<td><p>creates new files</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">close()</span></code></p></td>
<td><p>closes a file descriptor (reduces references to the file)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">lseek()</span></code></p></td>
<td><p>updates a file descriptor’s current file offset</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">read()</span></code></p></td>
<td><p>reads data from a file descriptor into a buffer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">write()</span></code></p></td>
<td><p>writes data from a buffer to a file descriptor</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dup()</span></code></p></td>
<td><p>duplicates one file descriptor</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dup2()</span></code></p></td>
<td><p>updates a file descriptor to point to another one</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fcntl()</span></code></p></td>
<td><p>changes file properties (asynchronous I/O, file locks)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ioctl()</span></code></p></td>
<td><p>a ‘catch all’ interface that interacts with device files, setting atypical properties, etc…</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">stat()</span></code></p></td>
<td><p>returns rwx bits, size, timestamps, and other details</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">access()</span></code></p></td>
<td><p>tests for read, write, execute, or existence of a file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">umask()</span></code></p></td>
<td><p>updates file creation mask</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">chmod()</span></code></p></td>
<td><p>updates rwx bits</p></td>
</tr>
</tbody>
</table>
</section>
<section id="more-filesystem-system-calls">
<h2>More Filesystem System Calls<a class="headerlink" href="#more-filesystem-system-calls" title="Permalink to this headline"></a></h2>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">Filesystem Calls</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">chown()</span></code></p></th>
<th class="head"><p>changes file user/group ownership</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">truncate()</span></code></p></td>
<td><p>change the length of a file (grow or shrink)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">link()</span></code></p></td>
<td><p>create a hard link</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">unlink()</span></code></p></td>
<td><p>remove a name in the filesystem and possibly the file it refers to (no processes have the file open)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rmdir()</span></code></p></td>
<td><p>deletes empty directories</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">remove()</span></code></p></td>
<td><p>combines unlink/rmdir into one call</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rename()</span></code></p></td>
<td><p>renames a file, possibly changing its parent folder</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">symlink()</span></code></p></td>
<td><p>creates a symbolic link</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">readlink()</span></code></p></td>
<td><p>reads the value of a symbolic link</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">utime()</span></code></p></td>
<td><p>updates the access and modification time</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mkdir()</span></code></p></td>
<td><p>creates a folder</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">opendir()</span></code></p></td>
<td><p>opens a folder for reading</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">readdir()</span></code></p></td>
<td><p>reads the next entry in a folder</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rewinddir()</span></code></p></td>
<td><p>resets directory entry to beginning</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">closedir()</span></code></p></td>
<td><p>closes a directory descriptor</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">chdir()</span></code></p></td>
<td><p>changes current working directory</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">getcwd()</span></code></p></td>
<td><p>gets current working directory</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sync()</span></code></p></td>
<td><p>flushes buffer cache for filesystem to disk</p></td>
</tr>
</tbody>
</table>
</section>
<section id="opening-files-with-open">
<h2>Opening Files with open()<a class="headerlink" href="#opening-files-with-open" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="kt">mode_t</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>pathname</em> is the path to the file</p></li>
<li><p><em>flags</em> can be combinations of:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">O_APPEND</span></code>: open in append mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O_ASYNC</span></code>: use signal driven asynchronous I/O</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O_CREAT</span></code>: create the file if it does not exist</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O_DIRECT</span></code>: minimize use of the buffer cache</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O_SYNC</span></code>: opened for synchronous I/O - block until write calls are
committed to hardware</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O_TRUNC</span></code>: if file already exists, truncate it to length 0</p></li>
<li><p>and many others…</p></li>
</ul>
</li>
<li><p><em>mode</em> is used for <code class="docutils literal notranslate"><span class="pre">O_CREAT</span></code> and is typically passed as an octal:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0XYZ</span></code>, <code class="docutils literal notranslate"><span class="pre">X</span></code> is for user, <code class="docutils literal notranslate"><span class="pre">Y</span></code> is for group, <code class="docutils literal notranslate"><span class="pre">Z</span></code> is for others</p></li>
<li><p>each digit, being an octal digit is composed of three bits</p></li>
<li><p>the most significant bit is read permissions</p></li>
<li><p>the next most significant bit is write permissions</p></li>
<li><p>the least significant bit is execute permissions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0700</span></code> means user has rwx, group and other have no access</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0660</span></code> means user/group have rw, other has no acess</p></li>
</ul>
</li>
<li><p>return value of <code class="docutils literal notranslate"><span class="pre">open()</span></code> is the file descriptor, or -1 if an error
happens</p></li>
</ul>
</section>
<section id="closing-files-with-close">
<h2>Closing files with close()<a class="headerlink" href="#closing-files-with-close" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>fd</em> argument is a file descriptor returned by a call to: open, dup,
pipe, etc…</p></li>
<li><p>return value is 0 on success or -1 on failure (bad file descriptor,
interrupted by signal)</p></li>
</ul>
</section>
<section id="writing-to-a-file">
<h2>Writing to a File<a class="headerlink" href="#writing-to-a-file" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>fd is an opened file descriptor</p></li>
<li><p>but is a buffer</p></li>
<li><p>count is the number of bytes from that buffer to write to the file at
the current offset</p></li>
<li><p>the return value of the method will be</p>
<ul>
<li><p><cite>return == -1</cite> if an error is encountered</p></li>
<li><p><cite>return == count</cite> in most successful cases</p></li>
<li><p><cite>return &lt; count</cite> in some implementations (network filesystems in some cases)</p></li>
</ul>
</li>
</ul>
</section>
<section id="typical-write-algorithm">
<h2>Typical Write Algorithm<a class="headerlink" href="#typical-write-algorithm" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;foobar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_CREAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_TRUNC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span><span class="w"></span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">written</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">length</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">written</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="reading-from-a-file">
<h2>Reading from a File<a class="headerlink" href="#reading-from-a-file" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>takes as arguments a file descriptor, a destination buffer, and the
number of bytes to read into that buffer</p></li>
<li><p>the return values of the method will be:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">==</span> <span class="pre">-1</span></code> if an error occurred</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">==</span> <span class="pre">0</span></code> if EOF is encountered</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">==</span> <span class="pre">count</span></code> in most success cases</p></li>
</ul>
</li>
</ul>
</section>
<section id="typical-read-algorithm">
<h2>Typical Read Algorithm<a class="headerlink" href="#typical-read-algorithm" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w"></span>
<span class="k">while</span><span class="p">((</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">length</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="seeking-within-a-file">
<h2>Seeking within a File<a class="headerlink" href="#seeking-within-a-file" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Not all files support seeking.</p></li>
<li><p>The use of seek calls is how random access I/O is performed</p></li>
<li><p>The use of seek calls have performance implications (more later…)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off_t</span> <span class="pre">lseek(int</span> <span class="pre">fd,</span> <span class="pre">off_t</span> <span class="pre">offset,</span> <span class="pre">int</span> <span class="pre">whence)</span></code></p>
<ul>
<li><p>fd is a file descriptor</p></li>
<li><p>offset is the number of bytes relative to whence</p></li>
<li><p>whence is one of <code class="docutils literal notranslate"><span class="pre">SEEK_SET</span></code> (beginning of file), <code class="docutils literal notranslate"><span class="pre">SEEK_CUR</span></code> (current
position of the file descriptor), or <code class="docutils literal notranslate"><span class="pre">SEEK_END</span></code> (end of the file)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">off_t</span></code> type is typically a 64-bit signed integer. It is possible
to seek both within and outside of a file.</p></li>
</ul>
</li>
<li><p>Seeking outside of a file will cause the value of 0 to be written
from the end of the file to the seek position.</p></li>
<li><p>Filesystems that support sparse files, will optimize this to prevent
unnecessary write operations.</p></li>
</ul>
</section>
<section id="standard-file-descriptors">
<h2>Standard File Descriptors<a class="headerlink" href="#standard-file-descriptors" title="Permalink to this headline"></a></h2>
<dl class="simple">
<dt>stdin</dt><dd><p>standard input. default is the input pipe from the console; default
value is 0</p>
</dd>
<dt>stdout</dt><dd><p>standard output. default is the output pipe to the console; default
value is 1</p>
</dd>
<dt>stderr</dt><dd><p>standard error. default is the output pipe to the console; default
value is 2</p>
</dd>
</dl>
<p>every program is initialized with these three file descriptors open by
default. their specific targets may have been redirected by the parent
program (more later…)</p>
</section>
<section id="duplicating-file-descriptors">
<h2>Duplicating File Descriptors<a class="headerlink" href="#duplicating-file-descriptors" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">dup</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">descriptor</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>accepts a file descriptor and returns a copy of it with a new id</p></li>
<li><p>the duplicated file descriptor has an independent file offset and
reference to the file</p></li>
<li><p>reasons to duplicate file descriptors:</p>
<ul>
<li><p>for use in multi-threading, to avoid calls to lseek()</p></li>
<li><p>one call necessary for redirecting stdin/stdout/stderr</p></li>
</ul>
</li>
</ul>
</section>
<section id="redirecting-file-descriptors">
<h2>Redirecting File Descriptors<a class="headerlink" href="#redirecting-file-descriptors" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">dup2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldfd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">redirect</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">descriptor</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>makes <code class="docutils literal notranslate"><span class="pre">newfd</span></code> be a copy of <code class="docutils literal notranslate"><span class="pre">oldfd</span></code></p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">newfd</span></code> is open, it is automatically closed</p></li>
<li><p>This call differs from <code class="docutils literal notranslate"><span class="pre">dup()</span></code> in that both of the file descriptors in
this case share the same file offset.</p></li>
<li><p>So, calling <code class="docutils literal notranslate"><span class="pre">lseek()</span></code> on one will cause the offset of the other to
change.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dup()</span></code> and <code class="docutils literal notranslate"><span class="pre">dup2()</span></code> are used to redirect <strong>stdin</strong>, <strong>stdout</strong>, and <strong>stderr</strong> on the
command line (sometimes to combine them)</p></li>
</ul>
</section>
<section id="redirecting-file-descriptors-code-example">
<h2>Redirecting File Descriptors code example<a class="headerlink" href="#redirecting-file-descriptors-code-example" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">pipe</span><span class="p">(</span><span class="n">pipes</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">            </span><span class="c1">//parent process</span>
<span class="w">        </span><span class="n">dup2</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">   </span><span class="c1">//redirect stdin</span>
<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">output</span><span class="p">);</span><span class="w">    </span><span class="c1">//close unused half of pipe</span>
<span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child sent value = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">//child process</span>
<span class="w">        </span><span class="n">dup2</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">//redirect STDOUT</span>
<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">input</span><span class="p">);</span><span class="w">        </span><span class="c1">//close unused half of pipe</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="reading-folders">
<h2>Reading Folders<a class="headerlink" href="#reading-folders" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">DIR</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opendir</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">struct</span> <span class="nc">dirent</span><span class="w"> </span><span class="o">*</span><span class="n">de</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="p">((</span><span class="n">de</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readdir</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;name %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">de</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">closedir</span><span class="p">(</span><span class="n">d</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="looking-ahead-i-o-performance">
<h2>Looking Ahead: I/O Performance<a class="headerlink" href="#looking-ahead-i-o-performance" title="Permalink to this headline"></a></h2>
</section>
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Achieving good I/O performance is about choosing the right buffering
strategy.</p></li>
<li><p>Reading/Writing with small buffers will lead to lower throughput.</p></li>
<li><p>Reading/Writing with large buffers will create a longer wait for
read/write to return.</p></li>
<li><p>This time could be used processing the data.</p></li>
<li><p>balance must be achieved.</p></li>
<li><p>Producer/Consumer models are advantageous:</p>
<ul>
<li><p>One process/thread reads a file (producer)</p></li>
<li><p>Another process/thread runs computation (consumer)</p></li>
<li><p>This way, you’re computing and performing I/O at the same
timeConsider memory mapped I/O - (more later when we talk about
IPC)</p></li>
</ul>
</li>
</ul>
</section>
<section id="simple-i-o-performance-experiment">
<h2>Simple I/O Performance Experiment<a class="headerlink" href="#simple-i-o-performance-experiment" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1</span> <span class="n">count</span><span class="o">=</span><span class="mi">1000000</span> <span class="o">-</span> <span class="mi">671</span> <span class="n">kB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">10</span> <span class="n">count</span><span class="o">=</span><span class="mi">100000</span> <span class="o">-</span> <span class="mf">5.9</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">100</span> <span class="n">count</span><span class="o">=</span><span class="mi">10000</span> <span class="o">-</span> <span class="mf">38.9</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1000</span> <span class="n">count</span><span class="o">=</span><span class="mi">1000</span> <span class="o">-</span> <span class="mi">244</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">10000</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span> <span class="o">-</span> <span class="mi">537</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">100000</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">834</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">dat</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1000000</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">461</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
</pre></div>
</div>
<p>In general:</p>
<ul class="simple">
<li><p>Increasing block size improves performance.</p></li>
<li><p>This is a single run of <code class="docutils literal notranslate"><span class="pre">dd</span></code> for each block size. Multiple runs would likely result in higher average throughput.</p></li>
<li><p>System load at any given time can impact the observed performance numbers.</p></li>
</ul>
</section>
<section id="reading-writing-performance">
<h2>Reading/Writing Performance<a class="headerlink" href="#reading-writing-performance" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Another approach to consider is Vectored I/O a.k.a. Gather-Scatter</p></li>
<li><p>Programs will often separate reads/writes into different calls.</p></li>
<li><p>One example would be a program that writes a header and then the
content in two separate calls.</p></li>
<li><p>Additional calls involve additional context switches and decreased
performance.</p></li>
<li><p>Vectored I/O allows several read/write calls to be combined.</p></li>
<li><p>Smart operating system implementations will also allow them to be
read/written out of order.</p></li>
<li><p>This can make for significant performance gains.</p></li>
<li><p>We’ll see more about this when we study the elevator algorithm as we
look deeper into storage topics.</p></li>
</ul>
</section>
<section id="performance-example">
<h2>Performance Example<a class="headerlink" href="#performance-example" title="Permalink to this headline"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcdefghijk&quot;</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_data3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lmnopqrstuvwxyz&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;temp.dat&quot;</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="w"> </span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">O_TRUNC</span><span class="o">|</span><span class="n">O_RDWR</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;open returned (-1)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">struct</span> <span class="nc">iovec</span><span class="w"> </span><span class="n">buffers</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_data1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">file_data1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_data2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">file_data2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_data3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">file_data3</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">writev</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">buffers</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">written</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;writev returned (-1)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;wrote %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">written</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="processes.html" class="btn btn-neutral float-left" title="Introduction to Processes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scheduling.html" class="btn btn-neutral float-right" title="Process/Thread Scheduling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2020, Operating Systems Faculty at Loyola University Chicago.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>