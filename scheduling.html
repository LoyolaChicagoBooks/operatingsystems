<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="./" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" metia="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Process/Thread Scheduling | Operating Systems: updated 28 Dec 2023</title>
<meta content="Process/Thread Scheduling | Operating Systems: updated 28 Dec 2023" property="og:title"/>
<meta content="Process/Thread Scheduling | Operating Systems: updated 28 Dec 2023" name="twitter:title"/>
<link href="_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="_static/theme.css?v=7112734b" rel="stylesheet" type="text/css"/>
<link href="search.html" rel="search" title="Search"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="mutualexclusion.html" rel="next" title="Mutual Exclusion"/>
<link href="files-io.html" rel="prev" title="Files and I/O"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Operating Systems: updated 28 Dec 2023</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="index.html"><span class="font-bold text-clip whitespace-nowrap">Operating Systems: updated 28 Dec 2023</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="meta.html">About the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="processes.html">Introduction to Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="files-io.html">Files and I/O</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Process/Thread Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutualexclusion.html">Mutual Exclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="deadlock.html">Deadlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">IPC Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernelmm.html">Virtual Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="userlandmm.html">Userland Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage and Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="fs.html">Implementing Files and Folders</a></li>
<li class="toctree-l1"><a class="reference internal" href="research.html">Storage Research at Loyola</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_vm.html">Installing a Linux Virtual Machine with VMware</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows_vm.html">Installing a Windows Virtual Machine with VMware</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="index.html">
<span class="hidden md:inline">Operating Systems: updated 28 Dec 2023</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Process/Thread Scheduling</span>
</nav>
<div id="content" role="main">
<section id="process-thread-scheduling">
<h1>Process/Thread Scheduling<a class="headerlink" href="#process-thread-scheduling" title="Link to this heading">¶</a></h1>
<section id="kernel-mode-vs-user-mode">
<h2>Kernel Mode vs. User Mode<a class="headerlink" href="#kernel-mode-vs-user-mode" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#kernel-mode-vs-user-mode'">¶</a></h2>
<p>Kernel Mode</p>
<ul>
<li><p>Can use the full instruction set of the CPU. Including:</p>
<blockquote>
<div><ul class="simple">
<li><p>Enabling / disabling interrupts</p></li>
<li><p>Setting special registers (page table pointer, interrupt table pointer, etc…)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Can modify any location in memory and modify page tables</p></li>
</ul>
<p>User Mode</p>
<ul class="simple">
<li><p>Cannot use privileged instructions.</p></li>
<li><p>Can only modify the memory assigned to the process.</p></li>
</ul>
</section>
<section id="interrupts">
<h2>Interrupts<a class="headerlink" href="#interrupts" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#interrupts'">¶</a></h2>
<ul>
<li><p>An interrupt is an event that requires immediate attention from the CPU.</p></li>
<li><p>Procedure for handling interrupts</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Save all registers including the program counter to memory (typically the stack, but not always)</p></li>
<li><p>CPU looks up the interrupt handler on the interrupt vector table and calls the interrupt handler</p></li>
<li><p>Once the interrupt handler is completed, it restores all registers and returns to the program counter. It may optionally retry the instruction that caused the interrupt (in the case of a page fault).</p></li>
<li><p>The program continues execution, not knowing anything has happened</p></li>
</ol>
</div></blockquote>
</li>
<li><p>This algorithm is the same for both hardware and software interrupts.</p></li>
</ul>
</section>
<section id="hardware-interrupts-pc-architecture">
<h2>Hardware Interrupts - PC Architecture<a class="headerlink" href="#hardware-interrupts-pc-architecture" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#hardware-interrupts-pc-architecture'">¶</a></h2>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/pc_architecture.png"><img alt="PC Architecture" src="_images/pc_architecture.png" style="height: 500px;"/></a>
</figure>
</section>
<section id="hardware-interrupts-sources">
<h2>Hardware Interrupts - Sources<a class="headerlink" href="#hardware-interrupts-sources" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#hardware-interrupts-sources'">¶</a></h2>
<ul>
<li><p>Southbridge (aka slow stuff) interrupts</p>
<blockquote>
<div><ul class="simple">
<li><p>Early 8088/8086 PCs had a chip called the Intel 8253.</p></li>
<li><p>SMP motherboards include a APIC or Advanced Programmable Interrupt Controller to help route interrupts in multi-processor scenarios</p></li>
<li><p>These chips control interrupts that come from disks, and</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Northbridge (aka fast stuff) Interrupts</p>
<blockquote>
<div><ul class="simple">
<li><p>MMU - page faults (not present, not valid, insufficient permissions)</p></li>
<li><p>ALU - divide by zero exception</p></li>
<li><p>Clock - clock ticks</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="software-interrupts">
<h2>Software Interrupts<a class="headerlink" href="#software-interrupts" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#software-interrupts'">¶</a></h2>
<ul class="simple">
<li><p>In operating systems that have separation between kernel and user space, software interrupts are used to implement system calls.</p></li>
<li><p>Hello world in x86 assembly:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>section .text
        global _start
_start:
        mov    edx, len      ; message length
        mov    ecx, msg      ; message to write
        mov    ebx, 1        ; 1 = stdout, the file descriptor
        mov    eax, 4        ; 4 = system call number (sys_write)
        int    0x80          ; software interrupt to call the kernel
section .data
        msg    db   'Hello World!',0xa
        len    equ  $ - msg
</pre></div>
</div>
<ul class="simple">
<li><p>Software interrupts are much more expensive than making direct function calls through ‘call’ or ‘jmp’ like instructions.</p></li>
<li><p>This cost is worth it in terms of the savings we get in terms of system reliability and security</p></li>
</ul>
</section>
<section id="goals-of-a-process-scheduler">
<h2>Goals of a Process Scheduler<a class="headerlink" href="#goals-of-a-process-scheduler" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#goals-of-a-process-scheduler'">¶</a></h2>
<ul>
<li><p>The attributes of a process scheduling policy are a combination of the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Fairness: make sure each process gets its fair share of the CPU.</p></li>
<li><p>Efficiency: keep the CPU as busy as possible</p></li>
<li><p>Response time: minimize the response time for interactive users.</p></li>
<li><p>Turnaround: minimize the time batch users must wait for output</p></li>
<li><p>Throughput: maximize the number of jobs processed per hour</p></li>
</ol>
</div></blockquote>
</li>
<li><p>There are no scheduler implementations that are optimal in each of these attributes. There is always a trade-off. Many of these attributes can be contradictory.</p></li>
</ul>
</section>
<section id="types-of-scheduling-strategies">
<h2>Types of Scheduling Strategies<a class="headerlink" href="#types-of-scheduling-strategies" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#types-of-scheduling-strategies'">¶</a></h2>
<ul>
<li><p>Preemptive</p></li>
<li><p>round-robin</p></li>
<li><p>priority scheduling</p>
<blockquote>
<div><ul class="simple">
<li><p>shortest job first</p></li>
<li><p>critical path</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Real-time</p>
<blockquote>
<div><ul class="simple">
<li><p>Earliest deadline</p></li>
<li><p>Fixed priority</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Cooperative / event driven</p></li>
<li><p>Run to completion / non-preemptive</p></li>
<li><p>Most modern operating systems use round-robin, preemptive scheduling with support for priorities.</p></li>
</ul>
</section>
<section id="os-support">
<h2>OS Support<a class="headerlink" href="#os-support" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#os-support'">¶</a></h2>
<ul>
<li><p>Non-Multitasking</p>
<blockquote>
<div><ul class="simple">
<li><p>CP/M</p></li>
<li><p>MS-DOS</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Cooperative multi-tasking</p>
<blockquote>
<div><ul class="simple">
<li><p>Windows 1.x-3.x</p></li>
<li><p>Mac OS 5 - 9</p></li>
<li><p>NetWare</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Preemptive multi-tasking</p>
<blockquote>
<div><ul class="simple">
<li><p>Minix</p></li>
<li><p>Windows 95-ME, NT4 - 7</p></li>
<li><p>Linux, BSDs</p></li>
<li><p>OS/2</p></li>
<li><p>Mac OSX</p></li>
<li><p>VMS</p></li>
<li><p>Unix</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="types-of-processes-to-schedule">
<h2>Types of Processes to Schedule<a class="headerlink" href="#types-of-processes-to-schedule" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#types-of-processes-to-schedule'">¶</a></h2>
<ul>
<li><p>Interactive processes</p>
<blockquote>
<div><ul class="simple">
<li><p>Spend most of their time in the <em>not ready</em> state.</p></li>
<li><p>Wait on either I/O operations to complete or for user interaction</p></li>
</ul>
</div></blockquote>
</li>
<li><p>CPU intensive processes</p>
<blockquote>
<div><ul class="simple">
<li><p>Spend most of their time in the ‘ready’ state.</p></li>
<li><p>Are largely CPU bound.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="preemptive-scheduling-key-terms">
<h2>Preemptive Scheduling Key Terms<a class="headerlink" href="#preemptive-scheduling-key-terms" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#preemptive-scheduling-key-terms'">¶</a></h2>
<ul class="simple">
<li><p><strong>Time Quantum</strong> - the allotted time slice a program is run before a scheduling decision. Typically less than or equal to a clock tick.</p></li>
<li><p><strong>Clock</strong> - one of two triggers for the scheduling algorithm. On most CPUs, the clock ticks at a rate of 50-100Hz. Each clock tick issues a hardware interrupt which permits the operating system to run the scheduler</p></li>
<li><p><strong>Context Switch</strong> - the process by which through a software or hardware interrupt, a process switches from user mode to kernel mode or from kernel mode to user mode</p></li>
</ul>
</section>
<section id="process-states">
<h2>Process states<a class="headerlink" href="#process-states" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#process-states'">¶</a></h2>
<ul class="simple">
<li><p>running - currently executing on one or more CPUs</p></li>
<li><p>ready - ready to be executed, but not running</p></li>
<li><p>not ready - not ready to run, currently waiting on an event</p></li>
<li><p>terminated - process has exited and is being cleaned up</p></li>
</ul>
</section>
<section id="choosing-a-quantum">
<h2>Choosing a Quantum<a class="headerlink" href="#choosing-a-quantum" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#choosing-a-quantum'">¶</a></h2>
<ul>
<li><p>Variables to consider</p>
<blockquote>
<div><ul class="simple">
<li><p>Context switch / scheduler Overhead</p></li>
<li><p>Quantum Length</p></li>
<li><p>Number of Processes</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Total Overhead: If overhead is 5ms and the quantum is 20ms, then overhead is 20%. If the quantum is 50ms, then the overhead is only 10%</p></li>
<li><p>Average Response Time: If overhead is 5ms, quantum, is 20ms, and 5 active processes exist, the time between runs will be: (overhead + quantum) * (runnable processes - 1) = 100ms. If the quantum is reduced to 10ms, then the time between runs will be: 60ms</p></li>
<li><p>So, the choice of a smaller quantum will make the system more responsive, and a longer quantum will make the system more efficient</p></li>
</ul>
</section>
<section id="context-switches">
<h2>Context Switches<a class="headerlink" href="#context-switches" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#context-switches'">¶</a></h2>
<ul class="simple">
<li><p>A context switch is the process by which a program saves it state to switch to the operating system</p></li>
<li><p>Context switches are caused by software and hardware interrupts</p></li>
</ul>
</section>
<section id="context-switching-how-it-works">
<h2>Context switching - How it works<a class="headerlink" href="#context-switching-how-it-works" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#context-switching-how-it-works'">¶</a></h2>
<ol class="arabic">
<li><p>Save CPU registers of currently running process into the process table.</p></li>
<li><p>Change the process state to</p>
<ul>
<li><p>Ready</p>
<blockquote>
<div><ul class="simple">
<li><p>if the context switch was caused by a hardware interrupt</p></li>
<li><p>if the context switch was caused by a software interrupt and the kernel
can return immediately (non blocking call)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Not Ready</p>
<blockquote>
<div><ul class="simple">
<li><p>if the context switch was caused by a software interrupt and the
kernel cannot return immediately (blocking call)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p>Invoke the scheduler to find a ‘ready’ process and change its state to ‘running’</p></li>
<li><p>Restore registers for the new process and switch back to user mode.</p></li>
</ol>
</section>
<section id="degrees-of-preemption">
<h2>Degrees of Preemption<a class="headerlink" href="#degrees-of-preemption" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#degrees-of-preemption'">¶</a></h2>
<ul>
<li><p>Different operating systems have different degrees of preemption.</p></li>
<li><p>In simpler operating systems, user-mode tasks can be preempted, but kernel-mode tasks cannot.</p></li>
<li><p>Systems that also allow kernel-mode tasks to be preempted will be more responsive</p></li>
<li><p>Systems with preemptive kernels:</p>
<blockquote>
<div><ul class="simple">
<li><p>Linux since 2.6 (2003)</p></li>
<li><p>Windows NT since NT4 (1996)</p></li>
<li><p>Solaris 2.0 (1991, I think)</p></li>
<li><p>AIX</p></li>
<li><p>Some BSD systems (NetBSD since v5, not sure about others)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The two units that can be considered for scheduling are threads and processes</p></li>
<li><p>Some operating systems only schedule on the process level and do not consider threads separately (Minix does this)</p></li>
<li><p>Other operating systems schedule on a per-thread level (Linux, Windows, OSX)</p></li>
</ul>
</section>
<section id="round-robin-process-scheduling">
<h2>Round - Robin Process Scheduling<a class="headerlink" href="#round-robin-process-scheduling" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#round-robin-process-scheduling'">¶</a></h2>
<ul>
<li><p>Round robin scheduling is the simplest scheduling policy, but not the most efficient</p></li>
<li><p>The operating system maintains two lists:</p>
<blockquote>
<div><ul class="simple">
<li><p>runnable list</p></li>
<li><p>non-runnable list</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The operating system simply runs through the runnable list in order executing each process one at a time. (or N at a time for N-CPUs)</p></li>
</ul>
</section>
<section id="scheduling-with-multiple-queues">
<h2>Scheduling with Multiple Queues<a class="headerlink" href="#scheduling-with-multiple-queues" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#scheduling-with-multiple-queues'">¶</a></h2>
<ul class="simple">
<li><p>Runnable threads are separated into queues based upon:</p></li>
<li><p>Quantum length</p></li>
<li><p>Process / thread priority</p></li>
<li><p>Each queue is then run round-robin</p></li>
<li><p>Algorithm (pseudo):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thread</span> <span class="n">schedule</span><span class="p">(</span><span class="n">thread</span> <span class="n">interruptedThread</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">let</span> <span class="n">highest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lowest</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
        <span class="n">Queue</span> <span class="n">runQueue</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="n">interruptedThread</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">runnable</span> <span class="ow">or</span> <span class="n">blocked</span>
        <span class="n">queue</span><span class="p">(</span><span class="n">interruptedThread</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">interruptedThread</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">highest</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">lowest</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">queue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="n">has</span> <span class="nb">any</span> <span class="n">runnable</span> <span class="n">threads</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">thread</span> <span class="n">t</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">dequeue</span><span class="p">();</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">running</span><span class="p">;</span>
                        <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>What are some problems with this scheduling algorithm?</p></li>
<li><p>What happens if higher priority threads are always runnable?</p></li>
<li><p>How do we give processes that don’t use their entire quantum (I/O bound) more priority?</p></li>
<li><p>Improved Algorithm (pseudo):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>thread schedule(thread interruptedThread) {
        let highest = 0, lowest = 9;
        Queue runQueue(10);
        if(interruptedThread.quantumUsed « Quantum) {
                interruptedThread.priority = max(interruptedThread.priority+1, highest);
        }
        interruptedThread.state = runnable or blocked
        queue(interruptedThread.priority).enqueue(interruptedThread)
        for(int i = highest; i «= lowest; i++) {
                if(queue(i) has any runnable threads) {
                        thread t = queue.dequeue();
                        t.state = running;
                        t.priority -= 1;
                        if(t.priority != t.basePriority &amp;&amp; t.priority »= lowest) {
                                t.priority = t.basePriority;
                        }
                        return t;
                }
        }
}
</pre></div>
</div>
<ul>
<li><p>The reason that this scheduler is better is because it accomplishes two things:</p>
<blockquote>
<div><ul class="simple">
<li><p>It boosts priority of threads that don’t completely use their allotted quantum (typically I/O bound)</p></li>
<li><p>If a thread is run, then its priority is temporarily decreased. The higher priority a thread is, the more chances it will have to run before it gets to the lowest queue. Also, this ensures that all ready processes will be run at some point.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>There are many variations on this type of scheduling that attempt to fine tune the rate of increase or decrease of thread priority. The most typical enhancement is to increase or decrease the amount of priority change with the number of priority changes.</p></li>
</ul>
</section>
<section id="real-time-schedulers">
<h2>Real-time Schedulers<a class="headerlink" href="#real-time-schedulers" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#real-time-schedulers'">¶</a></h2>
<ul>
<li><p>This is most typically used in real-time operating systems where the most important aspect of a process is not its priority but its deadline to complete a unit of work.</p></li>
<li><p>Attributes of real-time processes:</p>
<blockquote>
<div><ul>
<li><p>Arrival time (some absolute time)</p></li>
<li><p>Deadline (some time relative to the arrival time)</p></li>
<li><p>Execution requirement</p>
<blockquote>
<div><ul class="simple">
<li><p>Time for computation</p></li>
<li><p>Time to complete system calls</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>The goal of a real-time scheduler is to make sure as many processes as possible get their full execution requirement before the deadline.</p>
<blockquote>
<div><ul class="simple">
<li><p>This isn’t always possible (two processes arrive at the same time with 100ms requirements, both with deadlines 120ms away).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>In a real time scheduler, completion of all tasks before deadlines is the most important goal. The next important goal is achieving high CPU utilization.</p></li>
<li><p>Terms:</p>
<blockquote>
<div><ul class="simple">
<li><p>Utilization - the sum of the execution time divided by the arrival rate of the process (entering the runnable state)</p></li>
<li><p>Schedulable - a set of processes is ‘schedulable’ if the utilization of the system is less than 100%</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Example:</p>
<blockquote>
<div><ul class="simple">
<li><p>Pa requires 2 units of time and arrives at t=0,5,10,15,….</p></li>
<li><p>Pb requires 1 unit of time and arrives at t=2,4,6,8,10,….</p></li>
<li><p>Utilization is: 2/5 + 1/2 = 90%. Therefore the system is schedulable.</p></li>
<li><p>If Pc is added and requires 3 units of time and arrives at t=0,5,10,15,…. then utilization is 2/5 + 3/5 + 1/2 = 150% and the system is not schedulable. (at least some processes will miss their deadlines)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rts_1.png"><img alt="RTS Scheduler Example 1" src="_images/rts_1.png" style="width: 600px;"/></a>
</figure>
</section>
<section id="example-real-world-rts-problem">
<h2>Example Real World RTS Problem<a class="headerlink" href="#example-real-world-rts-problem" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#example-real-world-rts-problem'">¶</a></h2>
<ul>
<li><p>Example problem: Anti-Lock braking system.</p></li>
<li><p>Problem description:</p>
<blockquote>
<div><ul class="simple">
<li><p>Each wheel has a sensor that reports wheel speed every 15ms</p></li>
<li><p>An additional sensor reports vehicle speed every 15ms. Recording values takes 1ms.</p></li>
<li><p>Wheel angular velocity is (wheel speed) / (wheel radius)</p></li>
<li><p>Vehicle angular velocity is (vehicle speed) / (wheel radius)</p></li>
<li><p>Wheel slip is 1 - (wheel angular velocity) / (vehical angular velocity)</p></li>
<li><p>When slip = 1, a wheel is locked up. Ideal slip is 0.2.</p></li>
<li><p>Engineers report that slip can change at a rate of 0.1 per 50ms</p></li>
<li><p>Adjusting anti-lock brakes for all tires takes 6ms.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>What are the scheduling requirements of this system?</p></li>
<li><p>What are the processes?</p></li>
<li><p>What are the arrival rates and deadlines of processes?</p></li>
<li><p>Do we need faster sensors?</p></li>
<li><p>Can we save money by:</p>
<blockquote>
<div><ul class="simple">
<li><p>Getting a slower CPU?</p></li>
<li><p>Getting slower sensors?</p></li>
<li><p>Getting an ABS system that reacts slower?</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="solution-to-example-real-world-rts-problem">
<h2>Solution to Example Real World RTS Problem<a class="headerlink" href="#solution-to-example-real-world-rts-problem" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#solution-to-example-real-world-rts-problem'">¶</a></h2>
<ul class="simple">
<li><p>Sensor[A-D]: Period = 15ms, Requirement = 1ms</p></li>
<li><p>Sensor[V]: Period = 15ms, Requirement = 1ms</p></li>
<li><p>2 samples can be taken and recorded for each tire in a period of 15ms*2+5ms = 35ms (the first recording period overlaps with the second reading so we don’t count it)</p></li>
<li><p>If a problem is found, we can schedule a process to adjust anti-lock brakes which will take 6ms. 35ms + 6ms = 41ms. This is faster than the rate of change in slip of 50ms.</p></li>
<li><p>Is this schedulable? 1/15 + 1/15 + 1/15 + 1/15 + 1/15 + 6/35 = 50.47%. Yes!</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rts_2.png"><img alt="RTS Example 2" src="_images/rts_2.png" style="width: 800px;"/></a>
</figure>
<ul class="simple">
<li><p>It appears that we also have</p></li>
<li><p>8ms of extra time before our deadline</p></li>
<li><p>25ms of idle CPU time every 42ms</p></li>
<li><p>So, we can save money by using a slower CPU, ABS, and/or sensors.</p></li>
</ul>
</section>
<section id="types-of-real-time-scheduler-implementations">
<h2>Types of Real-Time Scheduler Implementations<a class="headerlink" href="#types-of-real-time-scheduler-implementations" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#types-of-real-time-scheduler-implementations'">¶</a></h2>
<ul>
<li><p>Earliest deadline first</p>
<blockquote>
<div><ul class="simple">
<li><p>Works with estimates of process runtimes and arrival rates.</p></li>
<li><p>When system utilization is over 100%, which processes miss deadlines is unpredictable</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Fixed priority</p>
<blockquote>
<div><ul class="simple">
<li><p>Gives the highest priority task CPU whenever it is in the ready state.</p></li>
<li><p>If utilization is over 100%, then lower priority tasks will not meet the deadline. This is more predictable and therefore more often favored</p></li>
<li><p>Simpler to implement</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="additional-concerns-in-advanced-scheduler-implementations">
<h2>Additional Concerns in Advanced Scheduler Implementations<a class="headerlink" href="#additional-concerns-in-advanced-scheduler-implementations" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#additional-concerns-in-advanced-scheduler-implementations'">¶</a></h2>
<ul>
<li><p>In more advanced operating systems, additional issues are considered in schedulers in addition to priority</p>
<blockquote>
<div><ul class="simple">
<li><p>CPU / Core affinity</p></li>
<li><p>How many pages of the working set of a process are resident</p></li>
<li><p>NUMA</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If a process is scheduled on a given core previously:</p>
<blockquote>
<div><ul class="simple">
<li><p>There is a decent chance that some of its pages are still in L1/L2/L3 cache.</p></li>
<li><p>Scheduling on that CPU again is better than not.</p></li>
<li><p>But, if too many processes are grouped on one CPU, they need to be migrated though.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>NUMA = Non Uniform Memory Access</p>
<blockquote>
<div><ul class="simple">
<li><p>This is common in machines with separate physical CPUs</p></li>
<li><p>Each CPU gets a memory bus to one bank of CPUs.</p></li>
<li><p>This means, that some of the memory is faster for for a given CPU and some memory is slower.</p></li>
<li><p>When choosing a CPU to execute on, where pages are allocated matters.</p></li>
<li><p>Also, when the OS allocates pages, taking into account which NUMA region has been used before and how crowded / busy it is also matters.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="process-priority-and-scheduling-in-linux">
<h2>Process Priority and Scheduling in Linux<a class="headerlink" href="#process-priority-and-scheduling-in-linux" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#process-priority-and-scheduling-in-linux'">¶</a></h2>
<ul>
<li><p>The Linux scheduler has several available policies:</p>
<blockquote>
<div><ul>
<li><p>Normal policies:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_OTHER</span></code> - round-robin time sharing polic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_BATCH</span></code> - batch policy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_IDLE</span></code> - for running very low priority background jobs</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Real-time policies:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_FIFO</span></code> - first-in, first-out  policy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_RR</span></code> - round-robin</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Scheduling policy is controlled by:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">sched_setscheduler(pid_t</span> <span class="pre">pid,</span> <span class="pre">int</span> <span class="pre">policy,</span> <span class="pre">sched_param</span> <span class="pre">*param);</span></code></p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">sched_param</span></code> struct, takes amongst other things, a priority value</p></li>
<li><p>this priority value is only consumed by the real time schedulers</p></li>
<li><p>normal policies make use of <em>nice</em> values</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="linux-real-time-scheduler">
<h2>Linux Real Time Scheduler<a class="headerlink" href="#linux-real-time-scheduler" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#linux-real-time-scheduler'">¶</a></h2>
<ul>
<li><p>In Linux, real-time processes always have priority over non-real time processes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_FIFO</span></code></p>
<blockquote>
<div><ul>
<li><p>Has one FIFO queue per-priority</p></li>
<li><p>When sched_setscheduler is called, the process goes into the front of the queue.</p></li>
<li><p>If the process is preempted, it keeps its place in the queue.</p></li>
<li><p>If sched_yield is called, then the process moves to the back of the queue.</p></li>
<li><p>Once running, the process will continue running until:</p>
<blockquote>
<div><ul class="simple">
<li><p>A higher priority process becomes runnable</p></li>
<li><p>The process issues an I/O request</p></li>
<li><p>The process calls sched_yield()</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_FIFO</span></code> processes are prevented from locking the system up by the RLIMIT_RTTIME limit. This is the CPU time limit that a process may take up before issuing a system call. After this soft limit is hit, the process is signaled several time until a hard limit is reached. If the hard limit is reached, the process is killed.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_RR</span></code>:</p>
<blockquote>
<div><ul>
<li><p>Exactly the same as <code class="docutils literal notranslate"><span class="pre">SCHED_FIFO</span></code>, except:</p>
<blockquote>
<div><ul class="simple">
<li><p>each process has a finite quantum.</p></li>
<li><p>if a process is preempted, it moves to the back of the queue</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="linux-preemptive-scheduler">
<h2>Linux Preemptive Scheduler<a class="headerlink" href="#linux-preemptive-scheduler" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#linux-preemptive-scheduler'">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_OTHER</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>This is the default scheduling policy in Linux.</p></li>
<li><p>Uses <em>nice</em> values for prioritization.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_BATCH</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">SCHED_OTHER</span></code>, except…</p></li>
<li><p>Notifies scheduler that the process is both non-interactive and not I/O intensive</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCHED_IDLE</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">SCHED_OTHER</span></code>, except…</p></li>
<li><p>All processes in this class are always of lower priority than all other processes. This means that if any other process is runnable, these processes do not run.</p></li>
<li><p><em>nice</em> values are ignored completely</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="nice-values">
<h2>Nice Values<a class="headerlink" href="#nice-values" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#nice-values'">¶</a></h2>
<ul>
<li><p>Common in all Unix schedulers is the use of <em>nice</em> values.</p></li>
<li><p>The nice value is the priority level of a process.</p>
<blockquote>
<div><ul class="simple">
<li><p>The highest priority is -20</p></li>
<li><p>The lowest priority is 19</p></li>
<li><p>The typical default priority is 0.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>When a process calls fork(), the new process inherits the parent’s nice value.</p></li>
<li><p>Non-root processes can increase the nice value</p></li>
<li><p>Only root processes can decrease the nice value</p></li>
<li><p>The effect of the nice value differs between scheduler implementations and is not the only factor taken into account in scheduling decisions</p></li>
</ul>
</section>
<section id="process-scheduling-in-windows">
<h2>Process Scheduling in Windows<a class="headerlink" href="#process-scheduling-in-windows" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#process-scheduling-in-windows'">¶</a></h2>
<ul>
<li><p>Windows has 6 process classes with 7 priorities within each class</p></li>
<li><p>Classes:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Idle</p></li>
<li><p>Below Normal</p></li>
<li><p>Normal</p></li>
<li><p>Above Normal</p></li>
<li><p>High</p></li>
<li><p>Realtime</p></li>
</ol>
</div></blockquote>
</li>
<li><p>Below - High:</p>
<blockquote>
<div><ul class="simple">
<li><p>Within a class, processes time-share relative to priority</p></li>
<li><p>Lower classes are not run unless higher classes are not runnable (or there are other idle CPUs)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Idle - only runs if no other process is runnable</p></li>
<li><p>Realtime - always run when runnable, will not be interrupted until the process makes a system call or goes to sleep.</p></li>
<li><p>Process scheduler takes NUMA into account in:</p>
<blockquote>
<div><ul class="simple">
<li><p>XP Professional, Vista, 7</p></li>
<li><p>Server 2003 / 2008 / 2008R2</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Supports more advanced heap management and scheduling on systems with more than 64 CPUs in Server 2008R2 through the use of processor groups</p></li>
<li><p>Multimedia Class Scheduler Service:</p>
<blockquote>
<div><ul class="simple">
<li><p>Creates classes of processes that have a minimum CPU requirement that the OS must meet.</p></li>
<li><p>Typically used to make sure audio, video, etc… are responsive in the presence of higher system loads.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="user-mode-schedulers">
<h2>User-Mode Schedulers<a class="headerlink" href="#user-mode-schedulers" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#user-mode-schedulers'">¶</a></h2>
<ul>
<li><p>User-mode schedulers fall into two categories:</p>
<blockquote>
<div><ul class="simple">
<li><p>Per-process: N user threads per 1 process (N threads total)</p></li>
<li><p>Per-thread: N user threads per 1 kernel thread (N*K threads)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Options:</p>
<blockquote>
<div><ul>
<li><p>Windows:</p>
<blockquote>
<div><ul class="simple">
<li><p>UMS Scheduler Component - 64-bit Server 2k8, Win 7</p></li>
<li><p>Fibers</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Linux/Minix</p>
<blockquote>
<div><ul class="simple">
<li><p>GNU Pth</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Custom:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use of setjump, longjmp functions to save / switch stacks</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="user-mode-threads-why">
<h2>User-Mode Threads: Why?<a class="headerlink" href="#user-mode-threads-why" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#user-mode-threads-why'">¶</a></h2>
<ul>
<li><p>Useful on systems with no support for kernel threads:</p></li>
<li><p>Minix, Windows 3.x, Mac OS 5-9</p></li>
<li><p>Useful on systems with huge or volatile thread counts:</p>
<blockquote>
<div><ul class="simple">
<li><p>An 8-CPU system with 24-32 active threads that doesn’t create and destroy threads often, works very well.</p></li>
<li><p>An 8-CPU system with 2000 threads will grind to a halt.</p></li>
<li><p>An 8-CPU system with 10 threads, then 120 threads, then 5 threads, will waste a lot of time creating and destroying threads.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Creating and destroying user mode threads is relatively cheap when compared to kernel threads.</p></li>
<li><p>Systems like Erlang or others that create a high number of parallel components benefit greatly from being able to abstract an unlimited number of threads without the actual need for there to literally be that number of threads.</p></li>
</ul>
</section>
<section id="user-mode-threads-why-not">
<h2>User-Mode Threads: Why Not?<a class="headerlink" href="#user-mode-threads-why-not" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#user-mode-threads-why-not'">¶</a></h2>
<ul>
<li><p>User mode threads have a lower degree of parallelism than do kernel mode threads. If you have 10 user threads on one kernel thread, you still are only executing on one CPU</p></li>
<li><p>User mode threads don’t benefit from operating system scheduler advantages:</p>
<blockquote>
<div><ul class="simple">
<li><p>Knowledge about CPU consumption</p></li>
<li><p>Knowledge about memory utilization</p></li>
<li><p>Knowledge about the page table and NUMA configuration</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If one user mode thread locks up, it locks up its entire kernel thread. Other user mode threads on that kernel thread cannot proceed.</p></li>
<li><p>If one user mode thread makes a system call, the user mode threading library or the application must use asynchronous I/O function calls (which are more complex) to maintain responsiveness for other user mode threads. Otherwise the entire kernel thread will block.</p></li>
<li><p>User mode threads do not perform as well as a similar number of kernel threads for number crunching applications (unless the number is » 4 per CPU)</p></li>
<li><p>The reason for this is that kernel threads will have longer quantums than will user mode threads. User mode threads divide the quantum of one kernel mode thread.</p></li>
<li><p>This problem is not as important for interactive, I/O based, or mixed applications.</p></li>
</ul>
</section>
<section id="gnu-pth-user-mode-pthreads">
<h2>GNU - Pth - User Mode Pthreads<a class="headerlink" href="#gnu-pth-user-mode-pthreads" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#gnu-pth-user-mode-pthreads'">¶</a></h2>
<ul class="simple">
<li><p>GNU Pth maps pretty closely to normal posix threading libraries.</p></li>
<li><p>The use of GNU Pth is probably best illustrated with an example.</p></li>
<li><p>The interesting calls are (pth_accept, pth_write, and pth_sleep).</p></li>
<li><p>Since this program is I/O bound, we need to use asynchronous I/O calls to make sure all threads are responsive.</p></li>
<li><p>This is accomplished with pth_* calls such as pth_write, pth_accept.</p></li>
<li><p>These calls are asynchronous wrappers to normal system calls.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pth.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netdb.h&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">handler</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">_arg</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="p">{</span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">_arg</span><span class="p">);</span>
<span class="linenos">11</span><span class="w">    </span><span class="kt">time_t</span><span class="w"> </span><span class="n">now</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ct</span><span class="p">;</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">pth_write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">ct</span><span class="p">));</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="linenos">18</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">19</span><span class="p">}</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">ticker</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">_arg</span><span class="p">)</span>
<span class="linenos">22</span><span class="p">{</span>
<span class="linenos">23</span><span class="w">    </span><span class="kt">time_t</span><span class="w"> </span><span class="n">now</span><span class="p">;</span>
<span class="linenos">24</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ct</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">load</span><span class="p">;</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span>
<span class="linenos">28</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">29</span><span class="w">        </span><span class="n">pth_sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="linenos">30</span><span class="w">        </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">31</span><span class="w">        </span><span class="n">ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">);</span>
<span class="linenos">32</span><span class="w">        </span><span class="n">ct</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'\0'</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">        </span><span class="n">pth_ctrl</span><span class="p">(</span><span class="n">PTH_CTRL_GETAVLOAD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">load</span><span class="p">);</span>
<span class="linenos">34</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"ticker: time: %s, average load: %.2f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">load</span><span class="p">);</span>
<span class="linenos">35</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">36</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">37</span><span class="p">}</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="linenos">40</span><span class="p">{</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">pth_attr_t</span><span class="w"> </span><span class="n">attr</span><span class="p">;</span>
<span class="linenos">42</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">sar</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">protoent</span><span class="w"> </span><span class="o">*</span><span class="n">pe</span><span class="p">;</span>
<span class="linenos">44</span><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">peer_addr</span><span class="p">;</span>
<span class="linenos">45</span><span class="w">    </span><span class="kt">socklen_t</span><span class="w"> </span><span class="n">peer_len</span><span class="p">;</span>
<span class="linenos">46</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="n">sw</span><span class="p">;</span>
<span class="linenos">47</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="w">    </span><span class="n">pth_init</span><span class="p">();</span>
<span class="linenos">50</span><span class="w">    </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGPIPE</span><span class="p">,</span><span class="w"> </span><span class="n">SIG_IGN</span><span class="p">);</span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="w">    </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pth_attr_new</span><span class="p">();</span>
<span class="linenos">54</span><span class="w">    </span><span class="n">pth_attr_set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">PTH_ATTR_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">"ticker"</span><span class="p">);</span>
<span class="linenos">55</span><span class="w">    </span><span class="n">pth_attr_set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">PTH_ATTR_STACK_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span>
<span class="linenos">56</span><span class="w">    </span><span class="n">pth_attr_set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">PTH_ATTR_JOINABLE</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>
<span class="linenos">57</span><span class="w">    </span><span class="n">pth_spawn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">ticker</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="w">    </span><span class="n">pe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getprotobyname</span><span class="p">(</span><span class="s">"tcp"</span><span class="p">);</span>
<span class="linenos">60</span><span class="w">    </span><span class="n">sa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">p_proto</span><span class="p">);</span>
<span class="linenos">61</span><span class="w">    </span><span class="n">sar</span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="linenos">62</span><span class="w">    </span><span class="n">sar</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INADDR_ANY</span><span class="p">;</span>
<span class="linenos">63</span><span class="w">    </span><span class="n">sar</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="linenos">64</span><span class="w">    </span><span class="n">bind</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sar</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="p">));</span>
<span class="linenos">65</span><span class="w">    </span><span class="n">listen</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="linenos">66</span>
<span class="linenos">67</span><span class="w">    </span><span class="n">pth_attr_set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">PTH_ATTR_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">"handler"</span><span class="p">);</span>
<span class="linenos">68</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span>
<span class="linenos">69</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">70</span><span class="w">        </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pth_accept</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">peer_addr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">peer_len</span><span class="p">);</span>
<span class="linenos">71</span><span class="w">        </span><span class="n">pth_spawn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sw</span><span class="p">);</span>
<span class="linenos">72</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">75</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pthreads-kernel-threads">
<h2>PThreads - Kernel Threads<a class="headerlink" href="#pthreads-kernel-threads" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#pthreads-kernel-threads'">¶</a></h2>
<ul class="simple">
<li><p>Most POSIX compliant systems implement a pthreads library.</p></li>
<li><p>In Minix, the PThreads library makes use of a layer on top of pth.</p></li>
<li><p>In Linux, PThreads use the clone() system call to create lightweight processes (aka kernel threads).</p></li>
<li><p>Example</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* adapted from LLNL pthreads tutorial</span>
<span class="linenos"> 2</span><span class="cm"> * https://computing.llnl.gov/tutorials/pthreads</span>
<span class="linenos"> 3</span><span class="cm"> */</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="cp">#define NUM_THREADS     5</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">struct</span><span class="w"> </span><span class="nc">thread_data</span>
<span class="linenos">13</span><span class="p">{</span>
<span class="linenos">14</span><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">tid</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">square</span><span class="p">;</span>
<span class="linenos">16</span><span class="p">};</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">thread_data</span><span class="w"> </span><span class="n">thread_data_t</span><span class="p">;</span>
<span class="linenos">19</span>
<span class="linenos">20</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">PrintHello</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">td_ptr</span><span class="p">)</span>
<span class="linenos">23</span><span class="p">{</span>
<span class="linenos">24</span><span class="w">    </span><span class="n">thread_data_t</span><span class="w"> </span><span class="o">*</span><span class="n">td</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">thread_data_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">td_ptr</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"Hello World! It's me, thread #%ld!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">td</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">);</span>
<span class="linenos">26</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"sqr(%ld) = %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">td</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">,</span><span class="w"> </span><span class="n">td</span><span class="o">-&gt;</span><span class="n">square</span><span class="p">);</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">28</span><span class="p">}</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="linenos">31</span><span class="p">{</span>
<span class="linenos">32</span><span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">threads</span><span class="p">[</span><span class="n">NUM_THREADS</span><span class="p">];</span>
<span class="linenos">33</span><span class="w">    </span><span class="n">thread_data_t</span><span class="w"> </span><span class="n">thread_data</span><span class="p">[</span><span class="n">NUM_THREADS</span><span class="p">];</span>
<span class="linenos">34</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="linenos">35</span><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos">36</span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">&lt;</span><span class="n">NUM_THREADS</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span>
<span class="linenos">37</span><span class="w">    </span><span class="p">{</span>
<span class="linenos">38</span><span class="w">        </span><span class="n">thread_data</span><span class="p">[</span><span class="n">t</span><span class="p">].</span><span class="n">tid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos">39</span><span class="w">        </span><span class="n">thread_data</span><span class="p">[</span><span class="n">t</span><span class="p">].</span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos">40</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"In main: creating thread %ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="linenos">41</span><span class="w">        </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">threads</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">PrintHello</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">thread_data</span><span class="p">[</span><span class="n">t</span><span class="p">]);</span>
<span class="linenos">42</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
<span class="linenos">43</span><span class="w">        </span><span class="p">{</span>
<span class="linenos">44</span><span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">"ERROR; return code from pthread_create() is %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="p">);</span>
<span class="linenos">45</span><span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="linenos">46</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">47</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="w">    </span><span class="cm">/* Last thing that main() should do */</span>
<span class="linenos">50</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"Exiting main thread</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="linenos">52</span><span class="p">}</span>
</pre></div>
</div>
<p>This example is adapted from <a class="reference external" href="https://computing.llnl.gov/tutorials/pthreads">LLNL POSIX Threads Programming tutorial</a>. You can find these in our <code class="docutils literal notranslate"><span class="pre">systems-code-examples</span></code> repository in the <code class="docutils literal notranslate"><span class="pre">llnl_pthreads_examples</span></code> folder, which have been updated to compile cleanly and have proper build files.</p>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(var(--vh)-4rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#kernel-mode-vs-user-mode'" class="reference internal" href="#kernel-mode-vs-user-mode">Kernel Mode vs. User Mode</a></li>
<li><a :data-current="activeSection === '#interrupts'" class="reference internal" href="#interrupts">Interrupts</a></li>
<li><a :data-current="activeSection === '#hardware-interrupts-pc-architecture'" class="reference internal" href="#hardware-interrupts-pc-architecture">Hardware Interrupts - PC Architecture</a></li>
<li><a :data-current="activeSection === '#hardware-interrupts-sources'" class="reference internal" href="#hardware-interrupts-sources">Hardware Interrupts - Sources</a></li>
<li><a :data-current="activeSection === '#software-interrupts'" class="reference internal" href="#software-interrupts">Software Interrupts</a></li>
<li><a :data-current="activeSection === '#goals-of-a-process-scheduler'" class="reference internal" href="#goals-of-a-process-scheduler">Goals of a Process Scheduler</a></li>
<li><a :data-current="activeSection === '#types-of-scheduling-strategies'" class="reference internal" href="#types-of-scheduling-strategies">Types of Scheduling Strategies</a></li>
<li><a :data-current="activeSection === '#os-support'" class="reference internal" href="#os-support">OS Support</a></li>
<li><a :data-current="activeSection === '#types-of-processes-to-schedule'" class="reference internal" href="#types-of-processes-to-schedule">Types of Processes to Schedule</a></li>
<li><a :data-current="activeSection === '#preemptive-scheduling-key-terms'" class="reference internal" href="#preemptive-scheduling-key-terms">Preemptive Scheduling Key Terms</a></li>
<li><a :data-current="activeSection === '#process-states'" class="reference internal" href="#process-states">Process states</a></li>
<li><a :data-current="activeSection === '#choosing-a-quantum'" class="reference internal" href="#choosing-a-quantum">Choosing a Quantum</a></li>
<li><a :data-current="activeSection === '#context-switches'" class="reference internal" href="#context-switches">Context Switches</a></li>
<li><a :data-current="activeSection === '#context-switching-how-it-works'" class="reference internal" href="#context-switching-how-it-works">Context switching - How it works</a></li>
<li><a :data-current="activeSection === '#degrees-of-preemption'" class="reference internal" href="#degrees-of-preemption">Degrees of Preemption</a></li>
<li><a :data-current="activeSection === '#round-robin-process-scheduling'" class="reference internal" href="#round-robin-process-scheduling">Round - Robin Process Scheduling</a></li>
<li><a :data-current="activeSection === '#scheduling-with-multiple-queues'" class="reference internal" href="#scheduling-with-multiple-queues">Scheduling with Multiple Queues</a></li>
<li><a :data-current="activeSection === '#real-time-schedulers'" class="reference internal" href="#real-time-schedulers">Real-time Schedulers</a></li>
<li><a :data-current="activeSection === '#example-real-world-rts-problem'" class="reference internal" href="#example-real-world-rts-problem">Example Real World RTS Problem</a></li>
<li><a :data-current="activeSection === '#solution-to-example-real-world-rts-problem'" class="reference internal" href="#solution-to-example-real-world-rts-problem">Solution to Example Real World RTS Problem</a></li>
<li><a :data-current="activeSection === '#types-of-real-time-scheduler-implementations'" class="reference internal" href="#types-of-real-time-scheduler-implementations">Types of Real-Time Scheduler Implementations</a></li>
<li><a :data-current="activeSection === '#additional-concerns-in-advanced-scheduler-implementations'" class="reference internal" href="#additional-concerns-in-advanced-scheduler-implementations">Additional Concerns in Advanced Scheduler Implementations</a></li>
<li><a :data-current="activeSection === '#process-priority-and-scheduling-in-linux'" class="reference internal" href="#process-priority-and-scheduling-in-linux">Process Priority and Scheduling in Linux</a></li>
<li><a :data-current="activeSection === '#linux-real-time-scheduler'" class="reference internal" href="#linux-real-time-scheduler">Linux Real Time Scheduler</a></li>
<li><a :data-current="activeSection === '#linux-preemptive-scheduler'" class="reference internal" href="#linux-preemptive-scheduler">Linux Preemptive Scheduler</a></li>
<li><a :data-current="activeSection === '#nice-values'" class="reference internal" href="#nice-values">Nice Values</a></li>
<li><a :data-current="activeSection === '#process-scheduling-in-windows'" class="reference internal" href="#process-scheduling-in-windows">Process Scheduling in Windows</a></li>
<li><a :data-current="activeSection === '#user-mode-schedulers'" class="reference internal" href="#user-mode-schedulers">User-Mode Schedulers</a></li>
<li><a :data-current="activeSection === '#user-mode-threads-why'" class="reference internal" href="#user-mode-threads-why">User-Mode Threads: Why?</a></li>
<li><a :data-current="activeSection === '#user-mode-threads-why-not'" class="reference internal" href="#user-mode-threads-why-not">User-Mode Threads: Why Not?</a></li>
<li><a :data-current="activeSection === '#gnu-pth-user-mode-pthreads'" class="reference internal" href="#gnu-pth-user-mode-pthreads">GNU - Pth - User Mode Pthreads</a></li>
<li><a :data-current="activeSection === '#pthreads-kernel-threads'" class="reference internal" href="#pthreads-kernel-threads">PThreads - Kernel Threads</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2013-2020, Operating Systems Faculty at Loyola University Chicago Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 7.2.6</a></p>
</div>
</div>
</footer>
</div>
<script src="_static/documentation_options.js?v=360e3fcb"></script>
<script src="_static/doctools.js?v=888ff710"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="_static/theme.js?v=e8bd915e"></script>
</body>
</html>